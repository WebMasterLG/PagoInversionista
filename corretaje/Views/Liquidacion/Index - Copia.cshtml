@using corretaje.Models;
@using corretaje.Clases;
@using System.Configuration;

@model IEnumerable<corretaje.Clases.liquidaciones>

@{
    ViewBag.Title = "Liquidaciones";
    Layout = "~/Views/Shared/_Layout.cshtml";

    int IdUsuario = int.Parse(Request.Cookies["cookiePerfil"]["usuario"].ToString());
    int idPerfil = int.Parse(Request.Cookies["cookiePerfil"]["perfil"].ToString());
    int idSubper = int.Parse(Request.Cookies["cookiePerfil"]["idSubper"].ToString());
    int idArea = int.Parse(Request.Cookies["cookiePerfil"]["idArea"].ToString());

    string DirectorioDocumentos = ConfigurationManager.AppSettings.Get("directoriodocumentos");

    DateTime fecha = new DateTime();
    fecha = DateTime.Now;
    string ano = fecha.Year.ToString();
    string ano2 = fecha.Year.ToString();
    string mes = fecha.Month.ToString();
    string mes2 = fecha.Month.ToString();
    string dia = fecha.Day.ToString();
    if (mes.Length == 1)
    {
        mes = "0" + mes;
        mes2 = "0" + mes2;
    }


    if (dia.Length == 1)
    {
        dia = "0" + dia;
    }
    string fec = ano + "-" + mes + "-01";
    string fec2 = dia + "-" + mes + "-" + ano;

    int tot_com_neta = 0;
    int tot_com_iva = 0;
    int tot_descuentos = 0;
    int tot_a_pagar = 0;
    //string ruta = "";

    foreach (var item in Model)
    {
        int contrato = int.Parse(item.id_contrato);
        int prop_arriendo = int.Parse(item.id_prop_arriendo);
    }
}

<style>
    .ancho {
        width: 120px;
    }

    #tabla td {
        text-align: left;
        font-size: 9px;
    }

    .ocultar {
        display: none;
    }

    .contador {
        color: white;
        background-color: coral;
        border: 1px;
        -moz-border-radius: 50%;
        -webkit-border-radius: 50%;
        border-radius: 50%;
        padding-bottom: 4px;
        padding-top: 4px;
    }
</style>

<style>
    .flota_derecha {
        float: right;
    }
</style>

<script>
    $(function () {

        var idPerfil = @idPerfil;
        var idSubper = @idSubper;
        var IdUsuario = @IdUsuario;
        var idArea = @idArea;

        var tabla = $("#tabla").DataTable(
        {
            "language": {
                "sProcessing": "Procesando...",
                "sLengthMenu": "Mostrar _MENU_ registros",
                "sZeroRecords": "No se encontraron resultados",
                "sEmptyTable": "Ningún dato disponible en esta tabla",
                "sInfo": "Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",
                "sInfoEmpty": "Mostrando registros del 0 al 0 de un total de 0 registros",
                "sInfoFiltered": "(filtrado de un total de _MAX_ registros)",
                "sInfoPostFix": "",
                "sSearch": "Buscar:",
                "sUrl": "",
                "sInfoThousands": ",",
                "sLoadingRecords": "Cargando...",
                "oPaginate": {
                    "sFirst": "Primero",
                    "sLast": "Último",
                    "sNext": "Siguiente",
                    "sPrevious": "Anterior"
                },
                "oAria": {
                    "sSortAscending": ": Activar para ordenar la columna de manera ascendente",
                    "sSortDescending": ": Activar para ordenar la columna de manera descendente"
                }
                },
                columnDefs: [
                    { "orderable": false, "targets": 0 },
                    { "orderable": false, "targets": 15 },
                    { "orderable": false, "targets": 21 }
                ],
            "iDisplayLength": 25,
            "footerCallback": function (row, data, start, end, display) {

                var api = this.api(), data;

                // Remove the formatting to get integer data for summation
                var intVal = function (i) {
                    return typeof i === 'string' ?
                        i.replace(/[\$.]/g, '') * 1 :
                        typeof i === 'number' ?
                        i : 0;
                };

                // Total over all pages
                com_neta = api.column(12).data().reduce(function (a, b) { return intVal(a) + intVal(b); }, 0);
                com_iva = api.column(13).data().reduce(function (a, b) { return intVal(a) + intVal(b); }, 0);
                descuentos = api.column(14).data().reduce(function (a, b) { return intVal(a) + intVal(b); }, 0);
                a_pagar  = api.column(15).data().reduce(function (a, b) { return intVal(a) + intVal(b); }, 0);

                // Total over this page
                sub_com_neta = api.column(12, { page: 'current' }).data().reduce(function (a, b) { return intVal(a) + intVal(b); }, 0);
                sub_com_iva = api.column(13, { page: 'current' }).data().reduce(function (a, b) { return intVal(a) + intVal(b); }, 0);
                sub_descuentos = api.column(14, { page: 'current' }).data().reduce(function (a, b) { return intVal(a) + intVal(b); }, 0);
                sub_a_pagar  = api.column(15, { page: 'current' }).data().reduce(function (a, b) { return intVal(a) + intVal(b); }, 0);

                $("#sub_com_neta").html(accounting.formatMoney(sub_com_neta, "$ ", 0, ".", ","));
                $("#sub_com_iva").html(accounting.formatMoney(sub_com_iva, "$ ", 0, ".", ","));
                $("#sub_descuentos").html(accounting.formatMoney(sub_descuentos, "$ ", 0, ".", ","));
                $("#sub_a_pagar").html(accounting.formatMoney(sub_a_pagar, "$ ", 0, ".", ","));

                $("#com_neta").html(accounting.formatMoney(com_neta, "$ ", 0, ".", ","));
                $("#com_iva").html(accounting.formatMoney(com_iva, "$ ", 0, ".", ","));
                $("#descuentos").html(accounting.formatMoney(descuentos, "$ ", 0, ".", ","));
                $("#a_pagar").html(accounting.formatMoney(a_pagar, "$ ", 0, ".", ","));



},
                dom: 'B<"flota_derecha"lf>rtip',
                buttons: [
                    {
                        extend: 'colvis',
                        text: 'Columnas'
                    },
                    {
                        extend: 'excelHtml5',
                        text: 'Excel',
                        footer: true,
                        exportOptions: {
                            columns: ':visible'
                        },
                        filename: 'Solicitudes_Devolucion.xlsx'
                    },
                    {
                        extend: 'pdfHtml5',
                        orientation: 'landscape',
                        pageSize: 'LEGAL',
                        text: 'PDF',
                        footer: true,
                        exportOptions: {
                            columns: ':visible'
                        },
                        filename: 'Solicitudes_Devolucion.pdf'
                    }
                ]
        });


        $("#todos").click(function () {

            var estado = false;
            if ($("#pago_garantia").prop("checked")) {
                estado = true;
            }

            var allPages = tabla.cells().nodes();

            if ($(this).is(":checked")) {
                //$("input:checkbox[name='chk_cambio_estado']").prop("checked", true);
                //$("#tabla").find("input:checkbox[name='chk_cambio_estado']").prop("checked", true);
                $("input:checkbox[name='chk_cambio_estado']", allPages).prop('checked', true);
            } else {
                //$("input:checkbox[name='chk_cambio_estado']").prop("checked", false);
                //$("#tabla").find("input:checkbox[name='chk_cambio_estado']").prop("checked", false);
                $("input:checkbox[name='chk_cambio_estado']", allPages).prop('checked', false);
            }

            $("#pago_garantia").prop("checked", estado);

        });

        $("#todos_pcg").click(function () {

            var estado = false;
            if ($("#pago_garantia").prop("checked")) {
                estado = true;
            }

            if ($(this).is(":checked")) {
                $("input:checkbox[name='id_pcg']").prop("checked", true);
            } else {
                $("input:checkbox[name='id_pcg']").prop("checked", false);
            }

            $("#pago_garantia").prop("checked", estado);

        });

        //var max = tabla.rows().data();
        //var tt = 0;
        //max.each(function (val, ind) {
        //    tt = tt + 1;
        //});
        //alert(tabla.data().count());
        $("#cant_aprobs").html("&nbsp;&nbsp;"+tabla.data().count()+"&nbsp;&nbsp;");

        $(document).ready(function () {
            var fecha2 = "@fec";
            var estado_arriendo2 = 10;
            var estado_pago2 = 0;
            var param = { "fecha": fecha2, "fecha2": fecha2, "estado_arriendo": estado_arriendo2, "estado_pago": estado_pago2, "sac_inversionista": 0 };
            $.ajax({
                data: param,
                url: "@Url.Action("_FiltraAprobaciones", "liquidacion")",
                type: "POST",
                beforeSend: function () {
                    $("#resultados_aprobaciones").html("Un momento por favor.");
                },
                success: function (response) {
                    $("#resultados_aprobaciones").html(response);

                }
            });
            var estado_arriendo22 = 0;
            var param2 = { "fecha": fecha2, "fecha2": fecha2, "estado_arriendo": estado_arriendo22, "estado_pago": estado_pago2, "sac_inversionista": 0 };
            $.ajax({
                data: param2,
                url: "@Url.Action("_ListadoLiquidadas", "liquidacion")",
                type: "POST",
                beforeSend: function () {
                    $("#resultados_liquidacion_final").html("Un momento por favor.");
                },
                success: function (response) {
                    $("#resultados_liquidacion_final").html(response);
                }

            });
        });

        $("#boton_buscar").click(function () {

            var fecha_paso = "@fec";

            var fecha = $("#ano").val() + "-" + $("#mes").val() + "-01";
            var fecha2 = $("#ano_fin").val() + "-" + $("#mes_fin").val() + "-01";
            $("#mes_excel").val(fecha);
            $("#mes_excel_2").val(fecha2);

            if ($("#ano").val() == "" || $("#mes").val() == "") {
                fecha = "";
                $("#mes_excel").val(fecha_paso);
                $("#mes_excel_2").val(fecha_paso);
            }

            var estado_arriendo = $("#estado_arriendo").val();
            var estado_pago = $("#estado_pago").val();
            var sac_inversionista = $("#sac_inversionista").val();
            var forma_pago_liq = $("#forma_pago_liq").val();

            var param = {
                "fecha": fecha, "fecha2": fecha2, "estado_arriendo": estado_arriendo, "estado_pago": estado_pago, "sac_inversionista": sac_inversionista, "forma_pago_liq": forma_pago_liq };

                $.ajax({
                    data: param,
                    url: "@Url.Action("_FiltraLiquidaciones", "liquidacion")",
                    type: "POST",
                    beforeSend: function(){
                        $("#listado_busqueda").html("Un momento por favor.");
                    },
                    success: function (response) {
                        $("#listado_busqueda").html(response);
                    }
                });

        });

        $("#boton_buscar2").click(function () {

            var fecha2 = $("#ano2").val() + "-" + $("#mes2").val() + "-01";
            var fecha3 = $("#ano2_2_x").val() + "-" + $("#mes2_2").val() + "-01";

            if ($("#ano2").val() == "" || $("#mes2").val() == "") {
                fecha2 = "";
            }

            var estado_arriendo2 = "0";//$("#estado_arriendo2").val();
            var estado_pago2 = "0";//$("#estado_pago2").val();
            var sac_inversionista2 = $("#sac_inversionista2_2").val();

            var param = { "fecha": fecha2, "fecha2": fecha3, "estado_arriendo": estado_arriendo2, "estado_pago": estado_pago2, "sac_inversionista": sac_inversionista2 };

                $.ajax({
                    data: param,
                    url: "@Url.Action("_FiltraAprobaciones", "liquidacion")",
                    type: "POST",
                    beforeSend: function(){
                        $("#resultados_aprobaciones").html("Un momento por favor.");
                    },
                    success: function (response) {
                        $("#resultados_aprobaciones").html(response);
                    }
                });

        });

        $("#boton_buscar3").click(function () {

            //alert($("#sac_inversionista2_3").val());
            var fecha2 = $("#ano3").val() + "-" + $("#mes3").val() + "-01";
            var fecha3 = $("#ano2_2_xx").val() + "-" + $("#mes2_3").val() + "-01";

            if ($("#ano3").val() == "" || $("#mes3").val() == "") {
                fecha2 = "";
            }

            var estado_arriendo2 = "0";//$("#estado_arriendo2").val();
            var estado_pago2 = "0";//$("#estado_pago2").val();
            var sac_inversionista2 = $("#sac_inversionista2_3").val();

            var param = { "fecha": fecha2, "fecha2": fecha3, "estado_arriendo": estado_arriendo2, "estado_pago": estado_pago2, "sac_inversionista": sac_inversionista2 };

                $.ajax({
                    data: param,
                    url: "@Url.Action("_ListadoLiquidadas", "liquidacion")",
                    type: "POST",
                    beforeSend: function () {
                        $("#resultados_liquidacion_final").html("Un momento por favor.");
                    },
                    success: function (response) {
                        $("#resultados_liquidacion_final").html(response);
                    }
                });

        });

        $("#link_liquidacion").click(function () {
            var fecha2 = "@fec";

                var estado_arriendo2 = 10;
                var estado_pago2 = 0;

                var param = { "fecha": fecha2, "fecha2": fecha2, "estado_arriendo": estado_arriendo2, "estado_pago": estado_pago2, "sac_inversionista": 0 };

                $.ajax({
                    data: param,
                    url: "@Url.Action("_FiltraAprobaciones", "liquidacion")",
                    type: "POST",
                    beforeSend: function () {
                        $("#resultados_aprobaciones").html("Un momento por favor.");
                    },
                    success: function (response) {
                        $("#resultados_aprobaciones").html(response);
                    }
                });
            });

        $("#link_liquidacion_final").click(function () {
            var fecha2 = "@fec";

                var estado_arriendo2 = 0;
                var estado_pago2 = 0;

                var param = { "fecha": fecha2, "fecha2": fecha2, "estado_arriendo": estado_arriendo2, "estado_pago": estado_pago2, "sac_inversionista": 0 };

                $.ajax({
                    data: param,
                    url: "@Url.Action("_ListadoLiquidadas", "liquidacion")",
                    type: "POST",
                    beforeSend: function () {
                        $("#resultados_liquidacion_final").html("Un momento por favor.");
                    },
                    success: function (response) {
                        $("#resultados_liquidacion_final").html(response);
                    }
                });
        });

        $("#link_liquidacion_enrolamiento").click(function () {

                var param = { "sac": 0 };

                $.ajax({
                    data: param,
                    url: "@Url.Action("_ClientesEnrolamiento", "liquidacion")",
                    type: "POST",
                    beforeSend: function () {
                        $("#listado_enrolamiento").html("Un momento por favor.");
                    },
                    success: function (response) {
                        $("#listado_enrolamiento").html(response);
                    }
                });

        });

        $("botton").click(function () {
                var id = $(this).attr("id");
            if ( id != "btn_liberar_pago_info" && id != "btn_excel_facturas" && id != "btn_reliquidar" && id != "btn_liquidar_x" && id != "btn_re_operaciones" && id != "btn_re_gerencia" && id != "btn_re_finanzas" && id != "btn_enviar_por_mail" && id != "btn_liquidar_x_autom") {
                confirmar_cambio_estado($(this).attr("estado"));
            } else if (id == "btn_liquidar_x" && id != "btn_enviar_por_mail" & id != "btn_liquidar_x_autom") {
                confirmar_cambio_estado_liquidado($(this).attr("estado"));
            } else if (id == "btn_liquidar_x_autom") {
                confirmar_cambio_estado_liquidado_masivo($(this).attr("estado"));
            } else if (id == "btn_liberar_pago_info") {
                modal_liberar_pago();
                //alert($(this).attr("estado"));
            }

        })



        $("#btn_reliquidar").click(function () {

                var a = $("input:checkbox:checked");
                var ids_pago = Array.prototype.map.call(a, function (x) { if (x.id == "id2_aprob" ) { return x.value; } });
                //alert(ids_pago);
                var param = { "data": ids_pago };

                pop_up("#resultado_reliquidar", 640, 480);

                $.ajax({
                    data: param,
                    url: "@Url.Action("_Reliquidar", "liquidacion")",
                    type: "post",
                    beforeSend: function(){
                        $("#cont_resultado_reliquidar").html("Un momento por favor.");
                    },
                    success: function (response) {
                        $("#cont_resultado_reliquidar").html(response);
                    }
                });

                //_Reliquidar(string fecha, int rut)
            });

        $("#btn_cambio_estado").click(function () {
            cambiar_estado_pago($("#new_estado").val());
        });

        $("#btn_cambio_estado_liquidar").click(function () {
             Liquida_Cliente($("#new_estado_liquidar").val());
        });

        $("#btn_cambio_estado_liquidar_masivo").click(function () {
             Liquida_Cliente_Masivo($("#new_estado_liquidar_masivo").val());
        });

    });

    function confirmar_cambio_estado_liquidado(estado_nuevo) {

        var fecha = new Date(); //Fecha actual
        var mes = fecha.getMonth() + 1; //obteniendo mes
        var dia = fecha.getDate(); //obteniendo dia
        var ano = fecha.getFullYear(); //obteniendo año
        if (dia < 10) {
            dia = '0' + dia; //agrega cero si el menor de 10
        }
        if (mes < 10) {
            mes = '0' + mes//agrega cero si el menor de 10
        }
        var ne = estado_nuevo;

        document.getElementById('fecha_estado_liquidar').value = ano + "-" + mes + "-" + dia;
        document.getElementById('new_estado_liquidar').value = ne;
        pop_up("#modal_cambio_estado_liquidar", 700, 500);
        $("#fade").css("display", "none");

    }

    function abrir_modal_mail() {
        pop_up("#modal_cambio_estado_liquidar", 700, 500);
    }

    function confirmar_cambio_estado_liquidado_masivo(nuevo_estado) {
        var fecha = new Date(); //Fecha actual
        var mes = fecha.getMonth() + 1; //obteniendo mes
        var dia = fecha.getDate(); //obteniendo dia
        var ano = fecha.getFullYear(); //obteniendo año
        if (dia < 10) {
            dia = '0' + dia; //agrega cero si el menor de 10
        }
        if (mes < 10) {
            mes = '0' + mes//agrega cero si el menor de 10
        }

        document.getElementById('fecha_estado_liquidar_masivo').value = ano + "-" + mes + "-01";
        document.getElementById('new_estado_liquidar_masivo').value = nuevo_estado;
        pop_up("#modal_cambio_estado_liquidar_masivo", 700, 500);
        $("#fade").css("display", "none");
    }

    function Liquida_Cliente(estado_nuevo) {
        pop_up("#resultado_estado", 700, 500, scroll());
        $("#cont_resultado_estado").html("<br/><br/><br/><h3><center>Un Momento Por Favor...</center></h3><br/><br/><br/>");
        var a = $("input:checkbox:checked");
        cerrar_ventana('#modal_cambio_estado_liquidar');
        var ids_pago = Array.prototype.map.call(a, function (x) {
            if (x.value != "on" && x.id == "id2_aprob")
            {
                var datos = x.value.split('|');
                var rut = datos[0];
                var fecha = datos[1].replace('.','');
                var id_pago = datos[2];
                Genera_PDF_Liquidacion(id_pago, rut, fecha)
            }
        });
        $("#cont_resultado_estado").html("<br/><br/><br/><h3><center>Proceso Realizado.....</center></h3><br/><br/><br/>");
       //cambiar_estado_pago_liquidado();
    }

    function Liquida_Cliente_Masivo(estado_nuevo) {
        pop_up("#resultado_estado", 700, 500, scroll());
        cerrar_ventana('#modal_cambio_estado_liquidar_masivo');

        var param = { "fecha": $("#fecha_estado_liquidar_masivo").val() };
            $.ajax({
                data: param,
                url: "@Url.Action("_GeneracionMasivaLiquidacionPDF", "liquidacion")",
                type: "post",
                async: true,
                beforeSend: function(){
                    $("#cont_resultado_estado").html("<br/><br/><br/><h3><center>Un momento por favor...</center></h3><br/><br/><br/>");
                },
                success: function (response) {
                    $("#cont_resultado_estado").html(response);
                }
            });
    }

    function confirmar_cambio_estado(estado_nuevo) {

        var fecha = new Date(); //Fecha actual
        var mes = fecha.getMonth() + 1; //obteniendo mes
        var dia = fecha.getDate(); //obteniendo dia
        var ano = fecha.getFullYear(); //obteniendo año

        $("#fecha_estado").val(ano + "-" + mes + "-" + dia);
        document.getElementById('new_estado').value = estado_nuevo;

        if (dia < 10) {
            dia = '0' + dia; //agrega cero si el menor de 10
        }
        if (mes < 10) {
            mes = '0' + mes//agrega cero si el menor de 10
        }

        //if (confirm("¿Confirmar Cambio de Estado?     " + mes)) {
        //    cambiar_estado_pago(ne);
        //};
        $("#fecha_estado").attr("readonly", false);
        if (estado_nuevo == 20 || estado_nuevo == 30) {
            $("#fecha_estado").attr("readonly", true);
            $("#fecha_estado").val(ano + "-" + mes + "-" + dia);
        }

        $("#desc_fecha_camb_estado").html("Fecha : ");
        $("#titulo_cambio_estado").html("Confirmar cambio estado");
        @*$("#fecha_estado").val("@fec2");*@

        if (estado_nuevo == 32 || estado_nuevo == 45 || estado_nuevo == 55) {
            pop_up("#modal_cambio_estado_rechazo", 700, 500);
            $("#fade").css("display", "none");
        } else {

            if (estado_nuevo == 40) {
                $("#desc_fecha_camb_estado").html("Fecha de Transferencia : ");
                $("#titulo_cambio_estado").html("Confirmar Fecha de Pago");
                $("#fecha_estado").val("");
            }
            if (estado_nuevo == 20) {
                $("#titulo_cambio_estado").html("Confirmar Estado Solicitar T/F");
            }

            if (estado_nuevo == 30) {
                $("#titulo_cambio_estado").html("Confirmar Estado Aprobar T/F");
            }

            if (estado_nuevo == 10) {
                $("#titulo_cambio_estado").html("Confirmar Estado Pendiente");
            }

            if (estado_nuevo == 35) {
                $("#titulo_cambio_estado").html("Confirmar Liberación de Pago");
                var fecha = new Date(); //Fecha actual
                var mes = fecha.getMonth() + 1; //obteniendo mes
                var dia = fecha.getDate(); //obteniendo dia
                var ano = fecha.getFullYear(); //obteniendo año
                if (dia < 10) {
                    dia = '0' + dia; //agrega cero si el menor de 10
                }
                if (mes < 10) {
                    mes = '0' + mes//agrega cero si el menor de 10
                }
                $("#fecha_estado").val(ano + "-" + mes + "-" + dia);
            }

            pop_up("#modal_cambio_estado", 700, 500);
            $("#fade").css("display", "none");
        }
    }



    function Genera_PDF_Liquidacion(id_pago, rut, fecha) {
        var param = { "id_liq": 0, "rut": rut, "fecha": fecha, "almacenar": 1, "id_pago" : id_pago };
        $.ajax({
            data: param,
            async: false,
            url: "@Url.Action("_Guarda_PDF_Liquidacion", "liquidacion")",
            type: "POST"
        });
    }


    function cambiar_estado_pago_liquidado(nuevo_estado) {
            pop_up("#resultado_estado", 700, 500, scroll());
            $("#cont_resultado_estado").html("<h3>Proceso Realizado</h3>");
        }

    function cambiar_estado_pago(nuevo_estado) {

        var flag = false;
        if (nuevo_estado == 40) {
            if ($("#fecha_estado").val() == "") {
                alert("¡ Debe ingresar una fecha para continuar !");
                return false;
            } else {
                var fec = $("#fecha_estado").val().split('-');
                var fec2 = fec[2] + "-" + fec[1] + "-" + fec[0];
                if (confirm("¿ Esta seguro(a) que desea dar por Transferencia Verificada estos pagos, con fecha " + fec2 + " ?")) {
                    flag = true;
                } else {
                    flag = false;
                    return false;
                }
            }
        } else {
            flag = true;
        }



        if (flag == true) {

            var pago_garantia = 0;
            var a = $("input:checkbox:checked");
            var ids_pago = Array.prototype.map.call(a, function (x) { if (x.value != "on" && x.id == "chk_cambio_estado" ) { return x.value; } });
            var observacion = "";
            //alert(ids_pago.length);

            if (ids_pago.length >= 1) {

                if ($("#pago_garantia").prop('checked')) {
                    pago_garantia = 1;
                }

                //alert(ids_pago);

                var param = {
                    "id_pago": ids_pago,
                    "estado": nuevo_estado,
                    "fecha": $("#fecha_estado").val(),
                    "pago_c_gar": pago_garantia,
                    "id_banco": $("#id_banco").val(),
                    "tf_num": $("#n_tranfer").val(),
                    "observacion": observacion
                };

                pop_up("#resultado_estado", 700, 500, scroll());

                $.ajax({
                    data: param,
                    url: "@Url.Action("_CambiarEstadoLiquidacion", "liquidacion")",
                    type: "post",
                    beforeSend: function(){
                        $("#cont_resultado_estado").html("Un momento por favor.");
                    },
                    success: function (response) {
                        $("#cont_resultado_estado").html(response);
                    }
                });
            }
            else {
                alert("No ha seleccionado pagos.");
            }
        }

    }

        function cerrar_ventana(pVentana) {
            $("#fade").css("display", "none");
            $(pVentana).css("display", "none");
        }

        function cerrar_ventana_estado(pVentana) {
            $("#fade").css("display", "none");
            $(pVentana).css("display", "none");
            document.location = '@Url.Action("index","liquidacion")';
        }

        function eliminar_archivo(id, archivo) {
            //_EliminarArchivo(int id_pago)
            //alert(archivo);
            var param = { "id_pago": id };
            $.ajax({
                data: param,
                url: "@Url.Action("_EliminarArchivo", "liquidacion")",
                type: "post",
                beforeSend: function(){
                    //$("#mensajito_obs").html("Un momento por favor.");
                },
                success: function (response) {
                    var ret = response.split('|');
                    alert(ret[1]);
                    if (ret[0] == "true") {
                        document.location = '@Url.Action("index","liquidacion")';
                    }
                }
            });
        }

        function observprop(id, pAncho, pAlto) {
            var ancho = pAncho;
            var alto = pAlto;
            var pVentana = "#agregar_comentario";
            var param = { "id_pago": id };

            anchoActual = window.innerWidth;
            altoActual = window.innerHeight;

            margenTop = (((altoActual - alto - 40) / altoActual ) / 2 ) * 100
            porcTop = margenTop + '%';
            margenLeft = (((anchoActual - ancho - 50) / anchoActual ) / 2 ) * 100
            porcLeft = margenLeft + '%';

            if (altoActual < alto + 40) {
                $(pVentana).css("top","5px");
            } else {
                $(pVentana).css("top",porcTop);
            }

            if (anchoActual < ancho) {
                $(pVentana).css("left",0);
                $(pVentana).css("width","100%");
            } else {
                $(pVentana).css("left",porcLeft);
            }

            if (parseInt(window.innerHeight) > parseInt($("body").height()) ) {
                $("#fade").height(parseInt(window.innerHeight));
            } else {
                $("#fade").height(parseInt($("body").height()));
            }
            $("#fade").css("display","block");
            $(pVentana).css("display","block");

            $.ajax({
                data: param,
                url: "@Url.Action("_TraeObservacionesPago", "liquidacion")",
                type: "post",
                beforeSend: function(){
                    $("#cont_comentario").html("Un momento por favor.");
                },
                success: function (response) {
                    $("#cont_comentario").html(response);
                }
            });
        }


        function agregar_factura(id, pAncho, pAlto) {
            var ancho = pAncho;
            var alto = pAlto;
            var pVentana = "#agregar_factura";
            var param = { "id": id };

            anchoActual = window.innerWidth;
            altoActual = window.innerHeight;

            margenTop = (((altoActual - alto - 40) / altoActual ) / 2 ) * 100
            porcTop = margenTop + '%';
            margenLeft = (((anchoActual - ancho - 50) / anchoActual ) / 2 ) * 100
            porcLeft = margenLeft + '%';

            if (altoActual < alto + 40) {
                $(pVentana).css("top","5px");
            } else {
                $(pVentana).css("top",porcTop);
            }

            if (anchoActual < ancho) {
                $(pVentana).css("left",0);
                $(pVentana).css("width","100%");
            } else {
                $(pVentana).css("left",porcLeft);
            }

            if (parseInt(window.innerHeight) > parseInt($("body").height()) ) {
                $("#fade").height(parseInt(window.innerHeight));
            } else {
                $("#fade").height(parseInt($("body").height()));
            }
            $("#fade").css("display","block");
            $(pVentana).css("display","block");

            @*$.ajax({
            data: param,
            url: "@Url.Action("_TraeObservacionesProp", "propiedades")",
            type: "get",
        beforeSend: function(){
            $(pVentana).html("Un momento por favor.");
        },
        success: function (response) {
            $(pVentana).html(response);
        }
    });*@
        }

        function pop_up(pVentana, pAncho, pAlto) {

            var ancho = pAncho;
            var alto = pAlto;
            anchoActual = window.innerWidth;
            altoActual = window.innerHeight;

            margenTop = (((altoActual - alto - 40) / altoActual) / 2) * 100
            porcTop = margenTop + '%';
            margenLeft = (((anchoActual - ancho - 50) / anchoActual) / 2) * 100
            porcLeft = margenLeft + '%';

            if (altoActual < alto + 40) {
                //alert("")
                $(pVentana).css("top", "5px");
            } else {
                $(pVentana).css("top", porcTop);
            }

            //			alert("pVentana:" + pVentana)
            //			alert(porcLeft)
            if (anchoActual < ancho) {
                $(pVentana).css("left", 0);
                $(pVentana).css("width", "100%");
            } else {
                $(pVentana).css("left", porcLeft);
            }

            if (parseInt(window.innerHeight) > parseInt($("body").height())) {
                $("#fade").height(parseInt(window.innerHeight));
            } else {
                $("#fade").height(parseInt($("body").height()));
            }
            $("#fade").css("display", "block");
            $(pVentana).css("display", "block");
        }

    function pop_up2(pVentana, pAncho, pAlto) {

            var ancho = pAncho;
            var alto = pAlto;
            anchoActual = window.innerWidth;
            altoActual = window.innerHeight;

            margenTop = (((altoActual - alto - 40) / altoActual) / 2) * 100
            porcTop = margenTop + '%';
            margenLeft = (((anchoActual - ancho - 50) / anchoActual) / 2) * 100
            porcLeft = margenLeft + '%';

            if (altoActual < alto + 40) {
                //alert("")
                $(pVentana).css("top", "5px");
            } else {
                $(pVentana).css("top", porcTop);
            }

            //			alert("pVentana:" + pVentana)
            //			alert(porcLeft)
            if (anchoActual < ancho) {
                $(pVentana).css("left", 0);
                $(pVentana).css("width", "100%");
            } else {
                $(pVentana).css("left", porcLeft);
            }

            if (parseInt(window.innerHeight) > parseInt($("body").height())) {
                $("#fade").height(parseInt(window.innerHeight));
            } else {
                $("#fade").height(parseInt($("body").height()));
            }
            $("#fade").css("display", "none");
            $(pVentana).css("display", "block");
        }


    @*$(function () {
        $(".td_ant_prop").click(function () {
        //alert("HOLA");
            var zona = $(this).attr("zona");
            pop_up("#modal_antecedentes_propietario", 850, 700);
            var contrato = $(this).attr("id_contrato");
            var prop = $(this).attr("id_prop");
            var url = "@Url.Action("formmodprop","propiedades")/" + prop + "?estado=110&id_contrato=" + contrato + "&desde_liquidaciones=1"+zona;
            $("#frame_modal_antecedentes_propietario").attr("src", url);
            $("#fade").css("display", "none");
        //alert(url);
        });
    });*@

</script>

<br />

<!-- COMENTARIO DE PRUEBA PARA CLAUDIO -->

<div id="content">
    <ul id="tabs" class="nav nav-tabs" data-tabs="tabs">
        <li class="active"><a href="#aprobacion" data-toggle="tab" id="link_aprobacion">Aprobación <span class="contador" id="cant_aprobs"></span> </a></li>
        <li><a href="#liquidacion" data-toggle="tab" id="link_liquidacion">Preliquidación <span class="contador" id="cant_preli"></span></a></li>
        <li><a href="#liquidacion_final" data-toggle="tab" id="link_liquidacion_final">Liquidación <span class="contador" id="cant_liqui"></span></a></li>
        <li><a href="#enrolamiento" data-toggle="tab" id="link_liquidacion_enrolamiento">Enrolamiento PI</a></li>
    </ul>
    <div id="my-tab-content" class="tab-content">
        <div class="tab-pane fade in active" id="aprobacion">

            <div style="width: 99.8%; padding-top: 15px;">
                @*Formulario de Busqueda*@
                <div style="margin:0 auto; min-width: 1024px; width: 95%; color: #666;">
                    <div style="color:#ff8000; font-size:18px; vertical-align: middle" align="left"><strong>Busqueda de Aprobación</strong></div>
                </div>
                <div style="border: 0px solid #f39120; padding-bottom: 15px; width: 1500px; margin: 0 auto; color: #666666; margin-top: 5px;">
                    @using (Html.BeginForm("BuscarLiquidaciones", "liquidacion", FormMethod.Post, new { id = "Filtrar", name = "Filtrar" }))
                    {
                        <div class="celda" style="border: 0px solid #f39120;">
                            <div class="celda lista">
                                <div class="label">Mes Desde</div>
                                <select id="mes" name="mes" style="color: #666666; width:99%">
                                    <option value=''>Todos</option>
                                    <option value='01' @(mes == "01" ? "selected" : "")>Enero</option>
                                    <option value='02' @(mes == "02" ? "selected" : "")>Febrero</option>
                                    <option value='03' @(mes == "03" ? "selected" : "")>Marzo</option>
                                    <option value='04' @(mes == "04" ? "selected" : "")>Abril</option>
                                    <option value='05' @(mes == "05" ? "selected" : "")>Mayo</option>
                                    <option value='06' @(mes == "06" ? "selected" : "")>Junio</option>
                                    <option value='07' @(mes == "07" ? "selected" : "")>Julio</option>
                                    <option value='08' @(mes == "08" ? "selected" : "")>Agosto</option>
                                    <option value='09' @(mes == "09" ? "selected" : "")>Septiembre</option>
                                    <option value='10' @(mes == "10" ? "selected" : "")>Octubre</option>
                                    <option value='11' @(mes == "11" ? "selected" : "")>Noviembre</option>
                                    <option value='12' @(mes == "12" ? "selected" : "")>Diciembre</option>
                                    @*@Html.Partial("../propiedades/_ListaComboBox", PropiedadesModels.ComboboxProyectos())*@
                                </select>
                            </div>
                            <div class="celda" style="width: 100px;">
                                <div class="label">Año Desde</div>
                                <select id="ano" name="ano" style="color: #666666;">
                                    <option value=''>Todos</option>
                                    @{
                                        int ano_inicio = int.Parse(ano) - 10;
                                        int ano_fin = int.Parse(ano) + 2;
                                        while (ano_inicio <= ano_fin)
                                        {
                                            <option value="@ano_inicio" @(ano_inicio == int.Parse(ano) ? "selected" : "")>@ano_inicio</option>
                                            ano_inicio++;
                                        }
                                    }
                                </select>
                                @*<input type="text" id="ano" name="ano" value="@ano" maxlength="4" style="width: 100%">*@
                            </div>

                            <div class="celda lista">
                                <div class="label">Mes Hasta</div>
                                <select id="mes_fin" name="mess_fin" style="color: #666666; width:99%">
                                    <option value=''>Todos</option>
                                    <option value='01' @(mes == "01" ? "selected" : "")>Enero</option>
                                    <option value='02' @(mes == "02" ? "selected" : "")>Febrero</option>
                                    <option value='03' @(mes == "03" ? "selected" : "")>Marzo</option>
                                    <option value='04' @(mes == "04" ? "selected" : "")>Abril</option>
                                    <option value='05' @(mes == "05" ? "selected" : "")>Mayo</option>
                                    <option value='06' @(mes == "06" ? "selected" : "")>Junio</option>
                                    <option value='07' @(mes == "07" ? "selected" : "")>Julio</option>
                                    <option value='08' @(mes == "08" ? "selected" : "")>Agosto</option>
                                    <option value='09' @(mes == "09" ? "selected" : "")>Septiembre</option>
                                    <option value='10' @(mes == "10" ? "selected" : "")>Octubre</option>
                                    <option value='11' @(mes == "11" ? "selected" : "")>Noviembre</option>
                                    <option value='12' @(mes == "12" ? "selected" : "")>Diciembre</option>
                                    @*@Html.Partial("../propiedades/_ListaComboBox", PropiedadesModels.ComboboxProyectos())*@
                                </select>
                            </div>
                            <div class="celda" style="width: 100px;">
                                <div class="label">Año Hasta</div>
                                <select id="ano_fin" name="ano_fin" style="color: #666666;">
                                    <option value=''>Todos</option>
                                    @{
                                        int ano_inicio_2 = int.Parse(ano) - 10;
                                        int ano_fin_2 = int.Parse(ano) + 2;
                                        while (ano_inicio_2 <= ano_fin_2)
                                        {
                                            <option value="@ano_inicio_2" @(ano_inicio_2 == int.Parse(ano) ? "selected" : "")>@ano_inicio_2</option>
                                            ano_inicio_2++;
                                        }
                                    }
                                </select>
                                @*<input type="text" id="ano" name="ano" value="@ano" maxlength="4" style="width: 100%">*@
                            </div>


                            <div class="celda lista">
                                <div class="label">Estado pago arriendo</div>
                                <select id="estado_arriendo" name="estado_arriendo" style="color: #666666; width:99%;">
                                    <option value="0" selected>Todos</option>
                                    @Html.Partial("_ListaComboBox", PropiedadesModels.ListasCombobox(27, null))
                                </select>
                            </div>
                            <div class="celda lista">
                                <div class="label">Estado pago propietario</div>
                                <select id="estado_pago" name="estado_pago" style="color: #666666; width:99%;">
                                    <option value="0" selected>Todos</option>
                                    @Html.Partial("_ListaComboBox", PropiedadesModels.ListasCombobox(29, null))
                                </select>
                            </div>

                            <div class="celda lista">
                                <div class="label">Sac Inversionista</div>
                                <select id="sac_inversionista" name="sac_inversionista" style="color: #666666;  width:99%">
                                    <option value="0" selected>Todos</option>
                                    @{
                                        List<listascombobox> lstSac = PropiedadesModels.ListaSacInversionista(IdUsuario);
                                        foreach (var item2 in lstSac)
                                        {
                                            <option value="@item2.id">@item2.descripcion</option>
                                        }
                                    }
                                </select>
                            </div>
                            <div class="celda lista">
                                <div class="label">Formas de pago</div>
                                <select id="forma_pago_liq" name="forma_pago_liq" style="color: #666666;  width:99%">
                                    <option value="0" selected>Todas</option>
                                    @{
                                        List<listascombobox> lst2 = PropiedadesModels.ListasCombobox(8, null);
                                        foreach (var item2 in lst2)
                                        {
                                            <option value="@item2.id">@item2.descripcion</option>
                                        }
                                    }
                                </select>
                            </div>
                            <div class="celda" style="vertical-align: bottom">
                                <div id="boton_buscar" class="boton" style="margin:0 auto;  width:120px;">
                                    <div class="celda" style="margin-top:3px; "><img src="~/img/lupa.png"></div>
                                    <div class="celda" style="margin-top:2px;">Buscar</div>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            </div> @*Fin Formulario de Busqueda*@

            <hr />
            <div style="border: 0px solid #f39120; width: 99.8%; margin: auto;">
                @*Resultados de la Busqueda*@

                <section>
                    <div style="margin:0 auto; min-width:1024px; width: 95%;  border:0px solid #ccc; color:#666;">
                        <div style="clear:both">
                            <div style="background: #fcfcfc;" id="listado_busqueda">
                                <table id="tabla" width="100%" style="font-size:10px;" cellpadding="0" cellspacing="0" class="table table-striped table-condensed table-bordered table-hover display">
                                    <thead>
                                        @*<tr>
                        <th style="text-align: center;"><input type="checkbox" name="todos" id="todos"></th>
                        <th colspan="14"></th>
                        <th style="text-align: center;"><input type="checkbox" name="todos_pcg" id="todos_pcg" /></th>
                        <th colspan="6"></th>
                    </tr>*@
                                        <tr id="tit" style="background:#eeefff;">
                                            <th><input type="checkbox" name="todos" id="todos"></th>
                                            <th style="text-align: center;">Contrato</th>
                                            <th style="text-align: center;">Pago</th>
                                            <th style="text-align: left;">Mes</th>
                                            <th style="text-align: left;">Concepto</th>
                                            <th style="text-align: left;">Dirección</th>
                                            <th>Nº Dpto.</th>
                                            <th>Tipología</th>
                                            <th style="text-align:left">Propietario</th>
                                            <th><div align="right">Arriendo</div></th>
                                            <th style="text-align:left"><div align="center">Estado Arriendo</div></th>
                                            <th><div align="right">Com. %</div></th>
                                            <th style="width: 60px;"><div align="right">Com. Neta</div></th>
                                            <th style="width: 60px;"><div align="right">Com. IVA  </div></th>
                                            <th style="width: 60px;"><div align="right">Descuentos</div></th>
                                            <th style="width: 60px;"><div align="right">A Pagar</div></th>
                                            <th style="text-align: center;">Meses Gracia</th>
                                            <th style="text-align: center;">Pago Contra Garantía</th>
                                            @*<th style="text-align: center;">Cheque Rescatado</th>*@
                                            <th style="text-align: center;">Edo Pago</th>
                                            <th style="text-align: center;">Forma Pago</th>
                                            <th style="text-align: center;">Fecha Pago</th>
                                            <th style="text-align: center;">Ejecutivo SAC</th>
                                            <th><div align="left">Edo.Factura</div></th>
                                            <th><div align="center">Mail</div></th>
                                            <th><div align="left">Observ.</div></th>
                                            <th><div align="left">&nbsp;&nbsp;&nbsp;&nbsp;</div></th>
                                            @*<th><div align="right">Acción</div></th>*@
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var item in Model)
                                        {
                                            <tr>
                                                <td style="text-align: center;">
                                                    @*<span>Area = @idArea / SubPerf = @idSubper / Perfil = @idPerfil </span>*@

                                                    @if (idArea == 5) // Operaciones
                                                    {
                                                        if (item.estado_pago == "T/F Solicitada" || item.estado_pago == "Rechazo Operaciones" || item.estado_pago == "Rechazo Gerencia" || item.estado_pago == "T/F Aprobada" || item.estado_pago == "Rechazo Finanzas")
                                                        {
                                                            <input type="checkbox" name="chk_cambio_estado" id="chk_cambio_estado" value="@item.id_pago" estado_actual="@item.estado_pago">
                                                        }

                                                    }
                                                    else if (idSubper == 6) // Gerencia General
                                                    {
                                                        if (item.estado_pago == "T/F Aprobada" || item.estado_pago == "Rechazo Gerencia")
                                                        {
                                                            <input type="checkbox" name="chk_cambio_estado" id="chk_cambio_estado" value="@item.id_pago" estado_actual="@item.estado_pago">
                                                        }
                                                    }
                                                    else if (idArea == 8)
                                                    {
                                                        if (item.estado_pago == "Pago Liberado" || item.estado_pago == "Rechazo Gerencia" || item.estado_pago == "T/F Solicitada")
                                                        {
                                                            <input type="checkbox" name="chk_cambio_estado" id="chk_cambio_estado" value="@item.id_pago" estado_actual="@item.estado_pago">
                                                        }
                                                    }
                                                    else
                                                    {
                                                        if (idSubper == 8) // SAC
                                                        {
                                                            if (item.estado_pago == "Pendiente" || item.estado_pago == "T/F Solicitada" || item.estado_pago == "Rechazo Operaciones")
                                                            {
                                                                <input type="checkbox" name="chk_cambio_estado" id="chk_cambio_estado" value="@item.id_pago" estado_actual="@item.estado_pago">
                                                            }
                                                        }
                                                    }
                                                </td>
                                                <td>@item.id_contrato</td>
                                                <td>@item.id_pago</td>
                                                <td>@item.mes</td>
                                                <td><span style="color:@item.color_letra" title="@(item.b_repetido == "1" ?  "Repetido"  : "")">@item.concepto</span></td>
                                                <td><div style="cursor: pointer" onclick="antecedentes_click(@item.id_prop_arriendo, @item.id_contrato, '#antecedentes_propiedad')">@item.direccion &nbsp;&nbsp;&nbsp;</div></td>
                                                <td><div style="cursor: pointer" onclick="antecedentes_click(@item.id_prop_arriendo, @item.id_contrato, '#antecedentes_propiedad')">@item.num_depto &nbsp;&nbsp;&nbsp;</div></td>
                                                <td>@item.g_tipologia</td>
                                                <td><div style="cursor: pointer" onclick="antecedentes_click(@item.id_prop_arriendo, @item.id_contrato, '#antecedentes_propietario')">@item.propietario &nbsp;&nbsp;&nbsp;</div></td>
                                                <td><div align="right">@item.arriendo</div></td>
                                                <td><div align="center">@item.estado_arriendo</div></td>
                                                <td style="text-align: center;">@item.com_admin_por</td>
                                                <td style="text-align: right;" data-order="@int.Parse(Math.Round(double.Parse(item.com_neta), 0).ToString())">$ @String.Format("{0:n0}", int.Parse(Math.Round(double.Parse(item.com_neta), 0).ToString()))</td>
                                                <td style="text-align: right;" data-order="@int.Parse(Math.Round(double.Parse(item.com_iva), 0).ToString())">$ @String.Format("{0:n0}", int.Parse(Math.Round(double.Parse(item.com_iva), 0).ToString()))</td>
                                                <td style="text-align: right; cursor: pointer;" data-order="@int.Parse(item.descuentos)" onclick="descuentos_click(@item.id_prop_arriendo,'@item.propietario','@item.direccion','@item.num_depto',@item.id_contrato,2)">$ @String.Format("{0:n0}", int.Parse(item.descuentos))</td>
                                                <td style="text-align: right;" data-order="@int.Parse(item.a_pagar)">$ @String.Format("{0:n0}", int.Parse(item.a_pagar))</td>
                                                <td style="text-align: center;" data-order="@int.Parse(item.mes_gracia)">@item.mes_gracia</td>

                                                @if (item.b_pago_contra_garantia == "1")
                                                {
                                                    <td style="text-align: center; background-color:red"><input type="checkbox" class="id_pcg" name="id_pcg" id="id_pcg" value="@item.id_pago" @(item.b_pago_contra_garantia == "1" ? "checked" : "") /></td>
                                                }
                                                else
                                                {
                                                    <td style="text-align: center;"><input type="checkbox" class="id_pcg" name="id_pcg" id="id_pcg" value="@item.id_pago" @(item.b_pago_contra_garantia == "1" ? "checked" : "") /></td>
                                                }

                                                @*<td style="text-align: center;"><input type="checkbox" class="id_chr" name="id_chr" id="id_chr" value="@item.id_pago" @(item.cheque_rescatado == "1" ? "checked" : "") /></td>*@
                                                <td style="text-align: left;">@item.estado_pago</td>
                                                <td style="text-align: center;">@item.forma_pago</td>
                                                <td style="text-align:left">@item.tf_fecha</td>
                                                <td style="text-align:left">@item.sac_inversionista</td>
                                                <td><div align="left">@item.estado_factura</div></td>
                                                <td><div align="center">@item.mail</div></td>
                                                <td style="text-align: center;">
                                                    @if (idArea != 10)
                                                    {
                                                        if (idSubper != 9)
                                                        {
                                                            if (item.b_comentario == "1")
                                                            {
                                                                <img onClick="observprop(@item.id_pago,500,350)" src="img/lapiz_rojo.png" title="@item.observacion" style="cursor: pointer" height="12">
                                                            }
                                                            else
                                                            {
                                                                <img onClick="observprop(@item.id_pago,500,350)" src="img/lapiz_azul.png" title="@item.observacion" style="cursor: pointer" height="12">
                                                            }
                                                        }
                                                    }
                                                </td>
                                                <td style="text-align: center;">
                                                    @if (idArea != 10)
                                                    {
                                                        if (idSubper != 9)
                                                        {
                                                            <img src="~/img/descuentos3.png" title="Cuadro Descuentos" onclick="descuentos_click(@item.id_prop_arriendo,'@item.propietario','@item.direccion','@item.num_depto',@item.id_contrato,1)" id_prop=@item.id_prop_arriendo style="cursor: pointer" height="12">
                                                        }
                                                    }
                                                </td>
                                            </tr>
                                        }
                                    </tbody>
                                    <tfoot>
                                        <tr style="background:#eeefff;">
                                            <td colspan="12" style="text-align:right"><strong>Sub Totales</strong>&nbsp;&nbsp;</td>
                                            <td><div align="right"><strong id="sub_com_neta"></strong></div></td>
                                            <td><div align="right"><strong id="sub_com_iva"></strong></div></td>
                                            <td><div align="right"><strong id="sub_descuentos"></strong></div></td>
                                            <td><div align="right"><strong id="sub_a_pagar"></strong></div></td>
                                            <td colspan="10">&nbsp;</td>
                                        </tr>
                                        <tr style="background:#eeefff;">
                                            <td colspan="12" style="text-align:right"><strong>Totales</strong>&nbsp;&nbsp;</td>
                                            <td><div align="right"><strong id="com_neta"></strong></div></td>
                                            <td><div align="right"><strong id="com_iva"></strong></div></td>
                                            <td><div align="right"><strong id="descuentos"></strong></div></td>
                                            <td><div align="right"><strong id="a_pagar"></strong></div></td>
                                            <td colspan="10">&nbsp;</td>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>

                            <form action="@Url.Action("ExportarExcel","propiedades")" method="post" id="AExcel" name="AExcel" style="float: left;">
                                <input type="hidden" name="tipoproy2" id="tipoproy2" value="0" />
                                <input type="hidden" name="tipologia2" id="tipologia2" value="0" />
                                <input type="hidden" name="disponibilidad2" id="disponibilidad2" value="0" />
                                <input type="hidden" name="ejecutivo2" id="ejecutivo2" value="0" />
                                <input type="hidden" name="estado2" id="estado2" value="0" />
                                <input type="hidden" name="venc_cont2" id="venc_cont2" value="0" />
                                <input type="hidden" name="sac_inversionista2" id="sac_inversionista2" value="7" />
                                <input type="hidden" name="reparos2" id="reparos2" value="0" />
                                <input type="hidden" name="idFormato" id="idFormato" />
                                <input type="hidden" name="grilla" id="grilla" value="" />
                                <input type="hidden" name="fechaIni" id="fechaIni" value="2019-11-01" />
                                <input type="hidden" name="fechaFin" id="fechaFin" value="2019-11-01" />
                                <input type="hidden" name="id_estado_arriendo" id="id_estado_arriendo" value="0" />
                                <input type="hidden" name="id_estado_propietario" id="id_estado_propietario" value="0" />

                                <div style="margin-top: 10px; font-size:14px; cursor: pointer; width: 150px; float: left;" onclick="excel('excel_aprobaciones',500,284)">
                                    <img title="Exportar a Excel" src="~/img/excel.png">&nbsp;Exportar Excel
                                </div>
                                <div style="float: left;">
                                    <boton class="boton" style="width:120px; margin-top: 20px;" id="btn_cargar_facturas">Mail Info. Finanzas</boton>
                                </div>

                            </form>

                            @*@using (Html.BeginForm("ExportarExcel", "propiedades", FormMethod.Post, new { id = "AExcel", name = "AExcel" }))
                            {

                            }*@
                        </div>
                        @if (idArea != 10)
                        {
                            if (idSubper != 9)
                            {
                                <div style="margin-top:10px;border:0px solid #f30; float: right;" align="right">
                                    @using (Html.BeginForm("BuscarLiquidaciones", "liquidacion", FormMethod.Post, new { id = "CEstado", name = "CEstado" }))
                                    {
                                        <div class="celda accion" id="botones_transferencia" style="border:1px solid #ccc; padding:5px; background:#eeefff;">
                                            <div class="celda" style="width: 140px;">
                                                <select name="id_banco" id="id_banco" tyle="color: #666666; width:100%;">
                                                    <option value="0" selected>Banco</option>
                                                    @{
                                                        List<listascombobox> lst11 = PropiedadesModels.ListasCombobox(25, null);
                                                        foreach (var item11 in lst11)
                                                        {
                                                            <option value="@item11.id">@item11.descripcion</option>
                                                        }
                                                    }
                                                </select>
                                            </div>
                                            <input type="text" id="n_tranfer" name="n_tranfer" placeholder="Nº Transferencia" maxlength="40" style="width: 100px">
                                            @*<input type="text" id="fecha_estado" name="fecha_estado" style="display:none" placeholder="dd-mm-aaaa" value="@fec2" maxlength="12" style="width: 100px" onclick="displayCalendar(document.CEstado.fecha_estado, 'dd-mm-yyyy', this)">*@
                                            @{
                                                //if (idSubper == 8)
                                                //{
                                                <botton class="boton estado_inicial" style="width:120px;" id="btn_solicitud_tf" estado="20">Solicitar T/F</botton>
                                                @*}
                                                    else
                                                    {
                                                        <botton class="boton area_ope" style="width:120px;" id="btn_solicitud_tf" estado="20">Solicitar T/F</botton>
                                                    }*@
                                            }
                                            <botton class="boton estado_inicial" style="width:120px;" id="btn_aprobar" estado="30">Aprobar T/F</botton>

                                            @if (IdUsuario == 10016 || IdUsuario == 10008)
                                            {
                                                <boton class="boton" style="width:120px;" id="btn_env_mail_sol" onclick="enviar_mail_gerencia(1)">Mail Sol. Aprob.</boton>

                                            }

                                            @if (idArea == 8 || IdUsuario == 10008)
                                            {
                                                <boton class="boton" style="width:120px;" id="btn_env_mail_carga" onclick="enviar_mail_gerencia(2)">Mail Info. Carga</boton>
                                            }

                                            @if (idSubper == 6 || idPerfil == 1 || idPerfil == 13)
                                            {
                                                <boton class="boton" style="width:120px;" id="btn_env_mail_fin" onclick="enviar_mail_finanza(1)">Mail Info. Finanzas</boton>
                                            }

                                            <input type="hidden" name="pago_garantia" id="pago_garantia" value="0"><!-- Pago contra garantía -->
                                            <botton class="boton estado_inicial" style="width:120px;" id="btn_tf_verificada" estado="40">T/F Verificada</botton>

                                            <botton class="boton estado_inicial" style="width:120px;" id="btn_pendiente" estado="10">Pendiente</botton>
                                            @*<botton class="boton estado_inicial" style="width:120px;" id="btn_liquidar" estado="50">Liquidar</botton>*@

                                            <botton class="boton estado_inicial" style="width:120px;" id="btn_liberar_pago" estado="35">Liberar Pago</botton>
                                            <botton class="boton estado_inicial" style="width:20px;" id="btn_liberar_pago_info">?</botton>

                                            <botton class="boton estado_inicial btn_oculto btn_rechazado" style="width:120px;" id="btn_re_operaciones" estado="32">Rechazo Operaciones</botton>
                                            <botton class="boton estado_inicial btn_oculto btn_rechazado" style="width:120px;" id="btn_re_gerencia" estado="45">Rechazo Gerencia</botton>
                                            <botton class="boton estado_inicial btn_oculto btn_rechazado" style="width:120px;" id="btn_re_finanzas" estado="55">Rechazo Finanzas</botton>

                                        </div>
                                        <div class="celda" id="botones_gerente" style="display:none;">
                                            <div class="celda" style="width:160px;">
                                                <botton class="boton" style="width:150px;" id="btn_facturado" estado="60">Facturado</botton>
                                            </div>
                                            <div class="celda accion" style="width:130px;">
                                                <botton class="boton" style="width:80px;" id="btn_rechazar">Rechazar</botton>
                                            </div>
                                            <div id="boton_factura" class="celda ancho accion" style="width:140px;">
                                                <botton class="boton" style="width:130px;" id="btn_excel_facturas">Excel Facturas</botton>
                                            </div>
                                        </div>
                                        <div id="perfiles" style="cursor:pointer; font-size:10px; display: none">
                                            <div class="celda" onClick="perfil('F')">Finanzas - </div>
                                            <div class="celda" onClick="perfil('G')">Gerente</div>
                                        </div>
                                    }

                                </div>
                            }
                        }
                    </div>


                </section>


            </div>  @*Fin Resultados de la busqued*@

        </div>
        <div class="tab-pane fade" id="liquidacion">

            <div style="width: 99.8%; padding-top: 15px;">
                @*Formulario de Busqueda*@
                <div style="margin:0 auto; min-width: 1024px; width: 95%; color: #666;">
                    <div style="color:#ff8000; font-size:18px; vertical-align: middle" align="left"><strong>Busqueda de Preliquidación</strong></div>
                </div>
                <div class="filtro_liqui" style="border: 0px solid #f39120; padding-bottom: 15px; width: 1180px; margin: 0 auto; color: #666666; margin-top: 5px;">
                    @using (Html.BeginForm("BuscarLiquidaciones", "aprobacion", FormMethod.Post, new { id = "Filtrar2", name = "Filtrar2" }))
                    {
                        <div class="celda" style="border: 0px solid #f39120;">
                            <div class="celda lista">
                                <div class="label">Mes Desde</div>
                                <select id="mes2" name="mes2" style="color: #666666; width:99%">
                                    <option value=''>Todos</option>
                                    <option value='01' @(mes2 == "01" ? "selected" : "")>Enero</option>
                                    <option value='02' @(mes2 == "02" ? "selected" : "")>Febrero</option>
                                    <option value='03' @(mes2 == "03" ? "selected" : "")>Marzo</option>
                                    <option value='04' @(mes2 == "04" ? "selected" : "")>Abril</option>
                                    <option value='05' @(mes2 == "05" ? "selected" : "")>Mayo</option>
                                    <option value='06' @(mes2 == "06" ? "selected" : "")>Junio</option>
                                    <option value='07' @(mes2 == "07" ? "selected" : "")>Julio</option>
                                    <option value='08' @(mes2 == "08" ? "selected" : "")>Agosto</option>
                                    <option value='09' @(mes2 == "09" ? "selected" : "")>Septiembre</option>
                                    <option value='10' @(mes2 == "10" ? "selected" : "")>Octubre</option>
                                    <option value='11' @(mes2 == "11" ? "selected" : "")>Noviembre</option>
                                    <option value='12' @(mes2 == "12" ? "selected" : "")>Diciembre</option>
                                    @*@Html.Partial("../propiedades/_ListaComboBox", PropiedadesModels.ComboboxProyectos())*@
                                </select>
                            </div>
                            <div class="celda" style="width: 100px;">
                                <div class="label">Año Desde</div>
                                <select id="ano2" name="ano2" style="color: #666666;">
                                    <option value=''>Todos</option>
                                    @{
                                        int ano_inicio = int.Parse(ano2) - 10;
                                        int ano_fin = int.Parse(ano2) + 2;
                                        while (ano_inicio <= ano_fin)
                                        {
                                            <option value="@ano_inicio" @(ano_inicio == int.Parse(ano2) ? "selected" : "")>@ano_inicio</option>
                                            ano_inicio++;
                                        }
                                    }
                                </select>
                                @*<input type="text" id="ano" name="ano" value="@ano" maxlength="4" style="width: 100%">*@
                            </div>



                            <div class="celda lista">
                                <div class="label">Mes Hasta</div>
                                <select id="mes2_2" name="mes2_2" style="color: #666666; width:99%">
                                    <option value=''>Todos</option>
                                    <option value='01' @(mes2 == "01" ? "selected" : "")>Enero</option>
                                    <option value='02' @(mes2 == "02" ? "selected" : "")>Febrero</option>
                                    <option value='03' @(mes2 == "03" ? "selected" : "")>Marzo</option>
                                    <option value='04' @(mes2 == "04" ? "selected" : "")>Abril</option>
                                    <option value='05' @(mes2 == "05" ? "selected" : "")>Mayo</option>
                                    <option value='06' @(mes2 == "06" ? "selected" : "")>Junio</option>
                                    <option value='07' @(mes2 == "07" ? "selected" : "")>Julio</option>
                                    <option value='08' @(mes2 == "08" ? "selected" : "")>Agosto</option>
                                    <option value='09' @(mes2 == "09" ? "selected" : "")>Septiembre</option>
                                    <option value='10' @(mes2 == "10" ? "selected" : "")>Octubre</option>
                                    <option value='11' @(mes2 == "11" ? "selected" : "")>Noviembre</option>
                                    <option value='12' @(mes2 == "12" ? "selected" : "")>Diciembre</option>
                                    @*@Html.Partial("../propiedades/_ListaComboBox", PropiedadesModels.ComboboxProyectos())*@
                                </select>
                            </div>
                            <div class="celda" style="width: 100px;">
                                <div class="label">Año Hasta</div>
                                <select id="ano2_2_x" name="ano2_2_x" style="color: #666666;">
                                    <option value=''>Todos</option>
                                    @{
                                        int ano_inicio_2 = int.Parse(ano2) - 10;
                                        int ano_fin_2 = int.Parse(ano2) + 2;
                                        while (ano_inicio_2 <= ano_fin_2)
                                        {
                                            <option value="@ano_inicio_2" @(ano_inicio_2 == int.Parse(ano2) ? "selected" : "")>@ano_inicio_2</option>
                                            ano_inicio_2++;
                                        }
                                    }
                                </select>
                                @*<input type="text" id="ano" name="ano" value="@ano" maxlength="4" style="width: 100%">*@
                            </div>

                            <div class="celda lista">
                                <div class="label2">Sac Inversionista</div>
                                <select id="sac_inversionista2_2" name="sac_inversionista2_2" style="color: #666666;  width:99%">
                                    <option value="0" selected>Todos</option>
                                    @{
                                        List<listascombobox> lstSac = PropiedadesModels.ListaSacInversionista(IdUsuario);
                                        foreach (var item2 in lstSac)
                                        {
                                            <option value="@item2.id">@item2.descripcion</option>
                                        }
                                    }
                                </select>
                            </div>

                            <div class="celda" style="vertical-align: bottom">
                                <div id="boton_buscar2" class="boton" style="margin:0 auto;  width:120px;">
                                    <div class="celda" style="margin-top:3px; "><img src="~/img/lupa.png"></div>
                                    <div class="celda" style="margin-top:2px;">Buscar</div>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            </div> @*Fin Formulario de Busqueda*@

            <hr />

            <div style="border: 0px solid #f39120; width: 99.8%; margin: auto;">
                @*Resultados de la Busqueda*@
                <section>
                    <div style="margin:0 auto; min-width:1024px; width: 95%;  border:0px solid #ccc; color:#666;">
                        <div style="clear:both">
                            <div style="background: #fcfcfc;" id="resultados_aprobaciones">
                            </div>

                            @using (Html.BeginForm("ExportarExcel", "propiedades", FormMethod.Post, new { id = "AExcel2", name = "AExcel2" }))
                            {

                                <input type="hidden" name="tipoproy2" id="tipoproy2" value="0" />
                                <input type="hidden" name="tipologia2" id="tipologia2" value="0" />
                                <input type="hidden" name="disponibilidad2" id="disponibilidad2" value="0" />
                                <input type="hidden" name="ejecutivo2" id="ejecutivo2" value="0" />
                                <input type="hidden" name="estado2" id="estado2" value="0" />
                                <input type="hidden" name="venc_cont2" id="venc_cont2" value="0" />
                                <input type="hidden" name="sac_inversionista2" id="sac_inversionista2" value="7" />
                                <input type="hidden" name="reparos2" id="reparos2" value="0" />
                                <input type="hidden" name="idFormato" id="idFormato" />
                                <input type="hidden" name="grilla" value="LIQUIDACIONES_PRINCIPAL" />
                                <input type="hidden" name="fechaIni" id="fechaIni" value="2019-11-01" />
                                <input type="hidden" name="fechaFin" id="fechaFin" value="2019-11-01" />
                                <input type="hidden" name="id_estado_arriendo" id="id_estado_arriendo" value="0" />
                                <input type="hidden" name="id_estado_propietario" id="id_estado_propietario" value="0" />

                                <div style="margin:5px; margin-top:10px; font-size:14px; cursor: pointer; width: 150px;" onclick="excel2('excel_liquidaciones',500,284)">
                                    <img title="Exportar a Excel" src="~/img/excel.png">&nbsp;Exportar Excel
                                </div>
                            }

                        </div>
                    </div>
                </section>
            </div>  @*Fin Resultados de la busqued*@
            @if (idArea != 10)
            {
                if (idSubper != 9)
                {
                    <div style="margin-top:10px; margin-right: 30px;" align="right">
                        @*Cambios de Estado*@
                        @using (Html.BeginForm("BuscarLiquidaciones", "liquidacion", FormMethod.Post, new { id = "CEstado2", name = "CEstado2" }))
                        {
                            <div class="celda">
                                <botton class="boton estado_inicial" style="width:160px;" id="btn_liquidar_x" estado="50">Liquidar Manual</botton>
                                <botton class="boton estado_inicial" style="width:160px;" id="btn_liquidar_x_autom" estado="500">Liquidar Automatico</botton>
                                @*<botton class="boton" style="width:120px;" id="btn_reliquidar">Reliquidar</botton>*@

                            </div>

                            <div class="celda" id="botones_gerente" style="display:none;">
                                <div class="celda" style="width:160px;">
                                    <botton class="boton" style="width:150px;" id="btn_facturado" estado="60">Facturado</botton>
                                </div>
                                <div class="celda accion" style="width:130px;">
                                    <botton class="boton" style="width:80px;" id="btn_rechazar">Rechazar</botton>
                                </div>
                                <div id="boton_factura" class="celda ancho accion" style="width:140px;">
                                    <botton class="boton" style="width:130px;" id="btn_excel_facturas">Excel Facturas</botton>
                                </div>
                            </div>


                            <div id="perfiles" style="cursor:pointer; font-size:10px; display: none">
                                <div class="celda" onClick="perfil('F')">Finanzas - </div>
                                <div class="celda" onClick="perfil('G')">Gerente</div>
                            </div>
                        }

                    </div> @*Fin Cambios de Estado*@
                }
            }

        </div>

        <div id="liquidacion_final" class="tab-pane fade">
            <div style="width: 99.8%; padding-top: 15px;">
                @*Formulario de Busqueda*@
                <div style="margin:0 auto; min-width: 1024px; width: 95%; color: #666;">
                    <div style="color:#ff8000; font-size:18px; vertical-align: middle" align="left"><strong>Busqueda de Liquidación</strong></div>
                </div>
                <div class="filtro_preliqui" style="border: 0px solid #f39120; padding-bottom: 15px; width: 1180px; margin: 0 auto; color: #666666; margin-top: 5px;">
                    @using (Html.BeginForm("BuscarPreLiquidaciones", "aprobacion", FormMethod.Post, new { id = "Filtrar3", name = "Filtrar3" }))
                    {
                        <div class="celda" style="border: 0px solid #f39120;">
                            <div class="celda lista">
                                <div class="label">Mes Desde</div>
                                <select id="mes3" name="mes3" style="color: #666666; width:99%">
                                    <option value=''>Todos</option>
                                    <option value='01' @(mes2 == "01" ? "selected" : "")>Enero</option>
                                    <option value='02' @(mes2 == "02" ? "selected" : "")>Febrero</option>
                                    <option value='03' @(mes2 == "03" ? "selected" : "")>Marzo</option>
                                    <option value='04' @(mes2 == "04" ? "selected" : "")>Abril</option>
                                    <option value='05' @(mes2 == "05" ? "selected" : "")>Mayo</option>
                                    <option value='06' @(mes2 == "06" ? "selected" : "")>Junio</option>
                                    <option value='07' @(mes2 == "07" ? "selected" : "")>Julio</option>
                                    <option value='08' @(mes2 == "08" ? "selected" : "")>Agosto</option>
                                    <option value='09' @(mes2 == "09" ? "selected" : "")>Septiembre</option>
                                    <option value='10' @(mes2 == "10" ? "selected" : "")>Octubre</option>
                                    <option value='11' @(mes2 == "11" ? "selected" : "")>Noviembre</option>
                                    <option value='12' @(mes2 == "12" ? "selected" : "")>Diciembre</option>
                                    @*@Html.Partial("../propiedades/_ListaComboBox", PropiedadesModels.ComboboxProyectos())*@
                                </select>
                            </div>
                            <div class="celda" style="width: 100px;">
                                <div class="label">Año Desde</div>
                                <select id="ano3" name="ano3" style="color: #666666;">
                                    <option value=''>Todos</option>
                                    @{
                                        int ano_inicio = int.Parse(ano2) - 10;
                                        int ano_fin = int.Parse(ano2) + 2;
                                        while (ano_inicio <= ano_fin)
                                        {
                                            <option value="@ano_inicio" @(ano_inicio == int.Parse(ano2) ? "selected" : "")>@ano_inicio</option>
                                            ano_inicio++;
                                        }
                                    }
                                </select>
                                @*<input type="text" id="ano" name="ano" value="@ano" maxlength="4" style="width: 100%">*@
                            </div>

                            <div class="celda lista">
                                <div class="label">Mes Hasta</div>
                                <select id="mes2_3" name="mes2_3" style="color: #666666; width:99%">
                                    <option value=''>Todos</option>
                                    <option value='01' @(mes2 == "01" ? "selected" : "")>Enero</option>
                                    <option value='02' @(mes2 == "02" ? "selected" : "")>Febrero</option>
                                    <option value='03' @(mes2 == "03" ? "selected" : "")>Marzo</option>
                                    <option value='04' @(mes2 == "04" ? "selected" : "")>Abril</option>
                                    <option value='05' @(mes2 == "05" ? "selected" : "")>Mayo</option>
                                    <option value='06' @(mes2 == "06" ? "selected" : "")>Junio</option>
                                    <option value='07' @(mes2 == "07" ? "selected" : "")>Julio</option>
                                    <option value='08' @(mes2 == "08" ? "selected" : "")>Agosto</option>
                                    <option value='09' @(mes2 == "09" ? "selected" : "")>Septiembre</option>
                                    <option value='10' @(mes2 == "10" ? "selected" : "")>Octubre</option>
                                    <option value='11' @(mes2 == "11" ? "selected" : "")>Noviembre</option>
                                    <option value='12' @(mes2 == "12" ? "selected" : "")>Diciembre</option>
                                    @*@Html.Partial("../propiedades/_ListaComboBox", PropiedadesModels.ComboboxProyectos())*@
                                </select>
                            </div>
                            <div class="celda" style="width: 100px;">
                                <div class="label">Año Hasta</div>
                                <select id="ano2_2_xx" name="ano2_2_xx" style="color: #666666;">
                                    <option value=''>Todos</option>
                                    @{
                                        int ano_inicio_2 = int.Parse(ano2) - 10;
                                        int ano_fin_2 = int.Parse(ano2) + 2;
                                        while (ano_inicio_2 <= ano_fin_2)
                                        {
                                            <option value="@ano_inicio_2" @(ano_inicio_2 == int.Parse(ano2) ? "selected" : "")>@ano_inicio_2</option>
                                            ano_inicio_2++;
                                        }
                                    }
                                </select>
                                @*<input type="text" id="ano" name="ano" value="@ano" maxlength="4" style="width: 100%">*@
                            </div>

                            <div class="celda lista">
                                <div class="label2">Sac Inversionista</div>
                                <select id="sac_inversionista2_3" name="sac_inversionista2_3" style="color: #666666;  width:99%">
                                    <option value="0" selected>Todos</option>
                                    @{
                                        List<listascombobox> lstSac = PropiedadesModels.ListaSacInversionista(IdUsuario);
                                        foreach (var item2 in lstSac)
                                        {
                                            <option value="@item2.id">@item2.descripcion</option>
                                        }
                                    }
                                </select>
                            </div>

                            <div class="celda" style="vertical-align: bottom">
                                <div id="boton_buscar3" class="boton" style="margin:0 auto;  width:120px;">
                                    <div class="celda" style="margin-top:3px; "><img src="~/img/lupa.png"></div>
                                    <div class="celda" style="margin-top:2px;">Buscar</div>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            </div> @*Fin Formulario de Busqueda*@

            <hr />
            <section>
                <div style="margin:0 auto; min-width:1024px; width: 95%;  border:0px solid #ccc; color:#666;">
                    <div style="background: #fcfcfc;" id="resultados_liquidacion_final">Un Momento por Favor</div>
                </div>
            </section>

            <div style="margin-top:10px; margin-right: 30px;" align="right">
                @if (idArea != 10)
                {
                    if (idSubper != 9)
                    {
                        <div class="celda">

                            <botton class="boton estado_inicial" style="width:120px;" id="btn_enviar_por_mail">Enviar Por Mail</botton>
                        </div>
                    }
                }
            </div>

        </div>

        <div id="enrolamiento" class="tab-pane fade">
            <div style="width: 99.8%; padding-top: 15px;">
                <div style="margin:0 auto; min-width: 1024px; width: 95%; color: #666;">
                    <div style="color:#ff8000; font-size:18px; vertical-align: middle" align="left"><strong>Enrolamiento Clientes PI</strong></div>
                </div>
            </div>
            <hr />
            <div id="listado_enrolamiento" style="border: 0px solid #f39120; width: 95%; margin: auto; background: #fcfcfc; color:#666;">

            </div>
        </div>

    </div>
</div>

<style>
    #btn_liberar_pago_info {
        background-color: #32CD32;
        color: #ffffff;
    }

        #btn_liberar_pago_info:hover {
            background-color: #00FF00;
            color: #000000;
        }
</style>

<div id="excel_aprobaciones" class="modal" style="width: 500px; height:284px; border: 1px solid #ccc; color: #666677; font-size:12px; display:none; padding:20px;  z-index: 5;">
    <div style="font-size:14px; border-bottom:1px solid #ff8000; padding-bottom:10px; ">
        <div class="celda"><h3><b>Formatos de exportación</b></h3></div>
    </div>
    <div class="celda" style="width: 100%; margin-top:10px;overflow-y:scroll; overflow-x:hidden; height:100px">
        <table id="formatosExcel_aprobaciones"></table>
    </div>
    <div style="width:99%; text-align:center;  margin-top: 20px;">
        <div class="celda ancho" style="width:100px; margin-left:10px">
            <div class="boton" style="width:70px;" onClick="cerrar_ventana('#excel_aprobaciones')">Cerrar</div>
        </div>
        <div class="celda ancho" style="width:100px; margin-left:10px">
            <div class="boton" style="width:89px;" id="exportar_excel_aprobaciones">Exportar</div>
        </div>
    </div>
</div>

<div id="excel_liquidaciones" class="modal" style="width: 500px; height:284px; border: 1px solid #ccc; color: #666677; font-size:12px; display:none; padding:20px;  z-index: 5;">
    <div style="font-size:14px; border-bottom:1px solid #ff8000; padding-bottom:10px; ">
        <div class="celda"><h3><b>Formatos de exportación</b></h3></div>
    </div>
    <div class="celda" style="width: 100%; margin-top:10px;overflow-y:scroll; overflow-x:hidden; height:100px">
        <table id="formatosExcel_liquidaciones"></table>
    </div>
    <div style="width:99%; text-align:center;  margin-top: 20px;">
        <div class="celda ancho" style="width:100px; margin-left:10px">
            <div class="boton" style="width:70px;" onClick="cerrar_ventana('#excel_liquidaciones')">Cerrar</div>
        </div>
        <div class="celda ancho" style="width:100px; margin-left:10px">
            <div class="boton" style="width:89px;" id="exportar_excel_liquidaciones">Exportar</div>
        </div>
    </div>
</div>



<script>

        var idAreaX = @idArea;
        var idSubperX = @idSubper;
        var idPerfilX = @idPerfil;

        $(".estado_inicial").css("pointer-events", "none");
        $(".btn_oculto").css("display", "none");
        $(".id_pcg").attr("disabled", true);
        //$(".id_chr").attr("disabled", true);
        $("#btn_liquidar_x_autom").css("pointer-events", "none");
        //$("#btn_liberar_pago_info").css("pointer-events", "none");

        if (idSubperX == 8 ) {  // SubPerfil SAC
            $("#btn_solicitud_tf").css("pointer-events", "auto");
            $("#btn_pendiente").css("pointer-events", "auto");
            $("#btn_enviar_por_mail").css("pointer-events", "auto");

            $("#btn_tf_verificada").css("display", "none");
            $("#btn_liberar_pago").css("display", "none");
            $("#btn_liberar_pago_info").css("display", "none");
            $("#btn_aprobar").css("display", "none");
        }

        if (idAreaX == 8) { // Area Finanzas
            $("#btn_tf_verificada").css("pointer-events", "auto");
            $("#btn_re_finanzas").css("display", "inline");
            $("#btn_re_finanzas").css("pointer-events", "auto");

            $("#btn_solicitud_tf").css("display", "none");
            $("#btn_aprobar").css("display", "none");
            $("#btn_liberar_pago").css("display", "none");
            $("#btn_liberar_pago_info").css("display", "none");
            $("#btn_pendiente").css("display", "none");
        }

        if (idAreaX == 5) { // Area Operaciones

            $("#btn_tf_verificada").css("display", "none");
            $("#btn_solicitud_tf").css("display", "none");
            $("#btn_liberar_pago_info").css("display", "none");
            $("#btn_pendiente").css("display", "none");

            $("#btn_aprobar").css("pointer-events", "auto");
            $("#btn_liquidar_x").css("pointer-events", "auto");
            $("#btn_re_operaciones").css("display", "inline");
            $("#btn_re_operaciones").css("pointer-events", "auto");
            $("#btn_liberar_pago").css("pointer-events", "auto");
            $(".id_pcg").attr("disabled", false);
            //$(".id_chr").attr("disabled", false);
            $("#btn_liquidar_x_autom").css("pointer-events", "auto");
        }

        if ( idPerfilX == 1) { // Perfil Administrador
            $(".estado_inicial").css("pointer-events", "auto");
            $("#btn_re_finanzas").css("display", "inline");
            $("#btn_re_operaciones").css("display", "inline");
            $("#btn_re_gerencia").css("display", "inline");
            $("#btn_liberar_pago").css("pointer-events", "auto");
            $("#btn_liquidar_x_autom").css("pointer-events", "auto");
        }

        if (idPerfilX == 13) {// Perfil Gerencia General
            $("#btn_liberar_pago").css("pointer-events", "auto");
            $("#btn_liberar_pago_info").css("pointer-events", "auto");
            $("#btn_re_gerencia").css("display", "inline");
        }


        if (idSubperX == 6) { //gerente general
            $(".estado_inicial").css("pointer-events", "none");
            $("#btn_re_finanzas").css("display", "none");
            $("#btn_re_operaciones").css("display", "none");
            $("#btn_re_gerencia").css("display", "inline");
            $("#btn_liberar_pago").css("pointer-events", "auto");
            $("#btn_re_gerencia").css("pointer-events", "auto");
            $("#btn_liberar_pago_info").css("pointer-events", "auto");
            $("#btn_liquidar_x_autom").css("pointer-events", "auto");

            $("#btn_solicitud_tf").css("display", "none");
            $("#btn_pendiente").css("display", "none");
            $("#btn_tf_verificada").css("display", "none");
            $("#btn_aprobar").css("display", "none");
    }



    $(".id_pcg").click(function () {
        var b_pago_contra_garantia = 0;
        var id_pago = $(this).val();
        if ($(this).prop('checked')) { b_pago_contra_garantia = 1; }
        if (b_pago_contra_garantia == 1) {
            if (confirm("¿ Quiere MARCAR este pago a 'Pago Contra Garantía' ?")) {
                var param = { "id_pago": id_pago, "b_pago_contra_garantia": b_pago_contra_garantia };
                $.ajax({
                    type: "POST",
                    url: "@Url.Action("_Marca_Pago_Contra_Garantia", "Liquidacion")",
                    data: param
                });
            } else {
                $(this).prop('checked', false);
            }
        }
        else {
            if (confirm("¿ Quiere DESMARCAR este pago de 'Pago Contra Garantía' ?")) {
                var param = { "id_pago": id_pago, "b_pago_contra_garantia": b_pago_contra_garantia };
                $.ajax({
                    type: "POST",
                    url: "@Url.Action("_Marca_Pago_Contra_Garantia", "Liquidacion")",
                    data: param
                });
            } else {
                $(this).prop('checked', true);
            }
        }
    });

    @*$(".id_chr").click(function () {
        var cheque_rescatado = 0;
        var id_pago = $(this).val();
        if ($(this).prop('checked')) { cheque_rescatado = 1; }
        if (cheque_rescatado == 1) {
            if (confirm("¿ Quiere MARCAR este cheque como 'Cheque Rescatado' ?")) {
                var param = { "id_pago": id_pago, "cheque_rescatado": cheque_rescatado };
                $.ajax({
                    type: "POST",
                    url: "@Url.Action("_Marca_Cheque_Rescatado", "Liquidacion")",
                    data: param
                });
            } else {
                $(this).prop('checked', false);
            }
        }
        else {
            if (confirm("¿ Quiere DESMARCAR este cheque como 'Cheque Rescatado' ?")) {
                var param = { "id_pago": id_pago, "cheque_rescatado": cheque_rescatado };
                $.ajax({
                    type: "POST",
                    url: "@Url.Action("_Marca_Cheque_Rescatado", "Liquidacion")",
                    data: param
                });
            } else {
                $(this).prop('checked', true);
            }
        }
    });*@

    function cerrar_ventana(pVentana) {
        $("#fade").css("display", "none");
        $(pVentana).css("display", "none");
    }

    $("#exportar_excel_liquidaciones").click(function () {
        var fechaIni = $("#ano2").val() + "-" + $("#mes2").val() + "-01";
        var fechaFin = $("#ano2_2_x").val() + "-" + $("#mes2_2").val() + "-01";
        $("#AExcel2 #idFormato").val($(".radioFormatoExcel_liq:checked").val());
        $("#tipoproy2").val("0");
        $("#tipologia2").val("0");
        $("#fechaIni").val(fechaIni);
        $("#fechaFin").val(fechaFin);
        $("#sac_inversionista2").val($("#sac_inversionista2_2").val());
        document.AExcel2.submit();
    });

    function excel2(id, pAncho, pAlto) {
        var pVentana = "#" + id;
        var ancho = parseInt($(pVentana).css("width").replace("px", ""));
        var alto = parseInt($(pVentana).css("height").replace("px", ""));

        anchoActual = window.innerWidth;
        altoActual = window.innerHeight;
        //alert(anchoActual + " " + altoActual)

        margenTop = Math.round((altoActual - alto) / 2)
        margenLeft = Math.round((anchoActual - ancho) / 2)
        //alert(margenTop + " " + margenLeft)

        if (altoActual < alto) {
            $(".modal").css("top", "5px");
        } else {
            $(".modal").css("top", margenTop + "px");
        }
        if (anchoActual < ancho) {
            $(".modal").css("left", 0);
            $(".modal").css("width", "100%");
        } else {
            $(".modal").css("left", margenLeft + "px");
        }

        if (parseInt(window.innerHeight) > parseInt($("body").height())) {
            $("#fade").height(parseInt(window.innerHeight));
        } else {
            $("#fade").height(parseInt($("body").height()));
        }

        //$("#fade").css("display", "block");
        $(pVentana).css("display", "block");

        $.ajax({
            url: "@Url.Action("FormatosExcel", "propiedades")",
            data: { grilla: "LIQUIDACIONES_PRINCIPAL" },
            type: "get",
            success: function (data) {
                if (data.resp.length > 0) {
                    $("#formatosExcel_liquidaciones tr").remove();
                    data.resp.map(function (obj) {
                        var fila = [];
                        fila.push("<td><input type='radio' value='" + obj.id + "' name='radioFormatoExcel_liq' class='radioFormatoExcel_liq' /> </td>");
                        fila.push("<td> " + obj.nombre + "</td>");
                        $("#formatosExcel_liquidaciones").append("<tr>" + fila.join('') + "</tr>");
                    });
                }
            }
        });
    }

    $("#exportar_excel_aprobaciones").click(function () {
        var fechaIni = $("#ano").val() + "-" + $("#mes").val() + "-01";
        var fechaFin = $("#ano_fin").val() + "-" + $("#mes_fin").val() + "-01";
        $("#idFormato").val($(".radioFormatoExcel_aprob:checked").val());
        $("#id_estado_arriendo").val($("#estado_arriendo").val());
        $("#id_estado_propietario").val($("#estado_pago").val());
        $("#fechaIni").val(fechaIni);
        $("#fechaFin").val(fechaFin);
        $("#sac_inversionista2").val($("#sac_inversionista").val());
        $("#grilla").val("LIQUIDACIONES_PRINCIPAL");
        document.AExcel.submit();
    });

    function excel(id, pAncho, pAlto) {
        var pVentana = "#" + id;
        var ancho = parseInt($(pVentana).css("width").replace("px", ""));
        var alto = parseInt($(pVentana).css("height").replace("px", ""));

        anchoActual = window.innerWidth;
        altoActual = window.innerHeight;
        //alert(anchoActual + " " + altoActual)

        margenTop = Math.round((altoActual - alto) / 2)
        margenLeft = Math.round((anchoActual - ancho) / 2)
        //alert(margenTop + " " + margenLeft)

        if (altoActual < alto) {
            $(".modal").css("top", "5px");
        } else {
            $(".modal").css("top", margenTop + "px");
        }
        if (anchoActual < ancho) {
            $(".modal").css("left", 0);
            $(".modal").css("width", "100%");
        } else {
            $(".modal").css("left", margenLeft + "px");
        }

        if (parseInt(window.innerHeight) > parseInt($("body").height())) {
            $("#fade").height(parseInt(window.innerHeight));
        } else {
            $("#fade").height(parseInt($("body").height()));
        }

        //$("#fade").css("display", "block");
        $(pVentana).css("display", "block");

        $.ajax({
            url: "@Url.Action("FormatosExcel", "propiedades")",
            data: { grilla: "LIQUIDACIONES_PRINCIPAL" },
            type: "get",
            success: function (data) {
                if (data.resp.length > 0) {
                    $("#formatosExcel_aprobaciones tr").remove();
                    data.resp.map(function (obj) {
                        var fila = [];
                        fila.push("<td><input type='radio' value='" + obj.id + "' name='radioFormatoExcel_aprob' class='radioFormatoExcel_aprob' /> </td>");
                        fila.push("<td> " + obj.nombre + "</td>");
                        $("#formatosExcel_aprobaciones").append("<tr>" + fila.join('') + "</tr>");
                    });
                }
            }
        });
    }

    $(".btn_rechazado").click(function () {


        var flag = true;
        var estado = $(this).attr("estado");
        var pago_c_gar = 0;
        var fecha = new Date(); //Fecha actual
        var mes = fecha.getMonth() + 1; //obteniendo mes
        var dia = fecha.getDate(); //obteniendo dia
        var ano = fecha.getFullYear(); //obteniendo año
        if (dia < 10) {
            dia = '0' + dia; //agrega cero si el menor de 10
        }
        if (mes < 10) {
            mes = '0' + mes//agrega cero si el menor de 10
        }
        var fecha_rechazo = ano + "-" + mes + "-" + dia;
        var a = $("input[name='chk_cambio_estado']:checkbox:checked");


        // Verica que existan registros seleccionados
        if (a.length <= 0) {
            alert("Atención: NO ha seleccionado ningún pago.");
            return false;
        }
        // Fin VERIFICACION

        a.each(function () {
            var usuario = "(@IdUsuario) ";

            var id_pago_p = $(this).val();
            var comentario = prompt("¡ Debe indicar un comentario para el pago " + id_pago_p + ", antes de continuar !");
            if (comentario == undefined) {
                flag = false;
                return false;
            } else if (comentario != "") {
                $(this).attr("observacion", comentario);
            } else {
                while (comentario == "") {
                    comentario = prompt("¡ Debe indicar un comentario para el pago " + id_pago_p + ", antes de continuar !");
                    if (comentario == undefined) {
                        flag = false;
                        return false;
                    }
                }
                $(this).attr("observacion", comentario);
            }
        });


        if (flag == true) {

            var obs_pago = new Array();
            a.each(function () {
                obs_pago.push($(this).attr("observacion"));
            });

            var ids_pago = Array.prototype.map.call(a, function (x) { return x.value; });


            var param = { "id_pago": ids_pago, "estado": estado, "fecha": fecha_rechazo, "pago_c_gar": pago_c_gar, "id_banco": $("#id_banco").val(),"tf_num": $("#n_tranfer").val(), "observacion": obs_pago };

                pop_up("#resultado_estado", 640, 480);

                $.ajax({
                    type: "POST",
                    url: "@Url.Action("_CambiarEstadoLiquidacionMasivo", "Liquidacion")",
                    data: param,
                    beforeSend: function () {
                        $("#cont_resultado_estado").html("<h3>Un momento por favor</h3>");
                    },
                    success: function (response) {
                        $("#cont_resultado_estado").html(response);
                    },
                    error: function () {
                        $("#cont_resultado_estado").html("<h3>Error al procesar su petición</h3>");
                    }
                });
        }
    });


</script>

<div id="fade" class="overlay">  </div>

<div id="agregar_comentario" class="modal" style="width: 600px; height:300px; border: 1px solid #ccc; color: #666677; font-size:12px; display:none; padding:20px; overflow-y:scroll">
    <div id="cont_comentario">

    </div>
    <div style="width:99%; text-align:center;  margin-top: 5px;">
        <div class="celda ancho" style="width:100px; margin-left:10px">
            <div class="boton" style="width:70px;" onClick="cerrar_ventana('#agregar_comentario')">Cerrar</div>
        </div>
    </div>
</div>

<div id="agregar_factura" class="modal" style="width: 600px; height:300px; border: 1px solid #ccc; color: #666677; font-size:12px; display:none; padding:20px">

    <div style="font-size:14px; border-bottom:1px solid #ff8000; margin-bottom:5px; width:100%">Agregar factura al Mes <strong>XXXXXXX de 9999</strong></div>
    <div style="font-size:12px; margin-top:10px;">
        <div class="celda" style="width:15%">Propietario:</div><div class="celda">Ricardo Lemus</div>
    </div>
    <div style="font-size:12px;">
        <div class="celda" style="width:15%">Dirección:</div><div class="celda" style="width:40%">José Miguel Carrera Nº1200</div>
        <div class="celda" style="width:20%">Departamento:</div><div class="celda" style="width:15%">1401</div>
    </div>
    <div align="center" style="padding:0; margin-top: 10px; ">
        <div>
            <textarea name="comentarios" id="comentarios" rows="5" style="width:95%"></textarea>
        </div>
    </div>
    <div style="width:99%; text-align:center;  margin-top: 20px;">
        <div class="celda ancho" style="width:100px; margin-left:10px">
            <div class="boton" style="width:70px;">Grabar</div>
        </div>
        <div class="celda ancho" style="width:100px; margin-left:10px">
            <div class="boton" style="width:70px;" onClick="cerrar_ventana('#agregar_factura')">Cerrar</div>
        </div>
    </div>

</div>

<div id="resultado_estado" class="modal" style="width: 750px; height:550px; border: 1px solid #ccc; color: #666677; font-size:12px; display:none; padding:20px; overflow:auto ">
    <div id="cont_resultado_estado">

    </div>
    <div style="width:99%; text-align:center;  margin-top: 5px;">
        <div class="celda ancho" style="width:100px; margin-left:10px">
            <div class="boton" style="width:70px;" onClick="cerrar_ventana_estado('#resultado_estado')">Cerrar</div>
        </div>
    </div>
</div>

<div id="resultado_reliquidar" class="modal" style="width: 640px; height:480px; border: 1px solid #ccc; color: #666677; font-size:12px; display:none; padding:20px">
    <div id="cont_resultado_reliquidar" style="height: 300px; overflow: auto;">

    </div>
    <div style="width:99%; text-align:center;  margin-top: 5px;">
        <div class="celda ancho" style="width:100px; margin-left:10px">
            <div class="boton" style="width:70px;" onClick="cerrar_ventana_estado('#resultado_reliquidar')">Cerrar</div>
        </div>
    </div>
</div>

<div id="modal_cambio_estado" class="modal" style="width: 500px; height:284px; border: 1px solid #ccc; color: #666677; font-size:12px; padding:20px;  z-index: 5;">
    <div style="font-size:14px; border-bottom:1px solid #ff8000; padding-bottom:10px; ">
        <div class="celda"><h3><b id="titulo_cambio_estado">Confirmar cambio estado</b></h3></div>
    </div>
    <div class="celda" style="width: 100%; margin-top:10px; height:100px">
        <center>
            <label style="font-size:12px;"><b id="desc_fecha_camb_estado">Fecha:&nbsp;&nbsp;</b></label>
            <input type="date" id="fecha_estado" name="fecha_estado" value="@fec2" maxlength="12" style="width: 150px" class="fecha_estado" />
            <input type="text" id="new_estado" value="" disabled hidden />
        </center>
    </div>
    <div style="width:99%; text-align:center;  margin-top: 10px;">
        <div class="celda ancho" style="width:100px; margin-left:10px">
            <div class="boton" style="width:89px;" id="btn_cambio_estado">SI</div>
        </div>
        <div class="celda ancho" style="width:100px; margin-left:10px">
            <div class="boton" style="width:89px;" onClick="cerrar_ventana('#modal_cambio_estado')">NO</div>
        </div>
    </div>
</div>

<div id="modal_cambio_estado_liquidar" class="modal" style="width: 500px; height:284px; border: 1px solid #ccc; color: #666677; font-size:12px; padding:20px;  z-index: 5;">
    <div style="font-size:14px; border-bottom:1px solid #ff8000; padding-bottom:10px; ">
        <div class="celda"><h3><b>Confirmar cambio estado</b></h3></div>
    </div>
    <div class="celda" style="width: 100%; margin-top:10px; height:100px">
        <center>
            <label style="font-size:12px;"><b>Fecha:&nbsp;&nbsp;</b></label>
            <input type="date" id="fecha_estado_liquidar" name="fecha_estado_liquidar" value="@fec2" maxlength="12" style="width: 150px" />
            <input type="text" id="new_estado_liquidar" value="" disabled hidden />
        </center>
    </div>
    <div style="width:99%; text-align:center;  margin-top: 10px;">
        <div class="celda ancho" style="width:100px; margin-left:10px">
            <div class="boton" style="width:89px;" id="btn_cambio_estado_liquidar">SI</div>
        </div>
        <div class="celda ancho" style="width:100px; margin-left:10px">
            <div class="boton" style="width:89px;" onClick="cerrar_ventana('#modal_cambio_estado_liquidar')">NO</div>
        </div>
    </div>
</div>

<div id="modal_cambio_estado_liquidar_masivo" class="modal" style="width: 500px; height:284px; border: 1px solid #ccc; color: #666677; font-size:12px; padding:20px;  z-index: 5;">
    <div style="font-size:14px; border-bottom:1px solid #ff8000; padding-bottom:10px; ">
        <div class="celda"><h3><b>Confirmar fecha de proceso</b></h3></div>
    </div>
    <div class="celda" style="width: 100%; margin-top:10px; height:100px">
        <center>
            <label style="font-size:12px;"><b>Fecha :&nbsp;&nbsp;</b></label>
            <input type="date" id="fecha_estado_liquidar_masivo" name="fecha_estado_liquidar_masivo" placeholder="dd-mm-aaaa" maxlength="12" style="width: 150px" />
            <input type="text" id="new_estado_liquidar_masivo" value="" disabled hidden />
        </center>
    </div>
    <div style="width:99%; text-align:center;  margin-top: 10px;">
        <div class="celda ancho" style="width:100px; margin-left:10px">
            <div class="boton" style="width:89px;" id="btn_cambio_estado_liquidar_masivo">SI</div>
        </div>
        <div class="celda ancho" style="width:100px; margin-left:10px">
            <div class="boton" style="width:89px;" onClick="cerrar_ventana('#modal_cambio_estado_liquidar_masivo')">NO</div>
        </div>
    </div>
</div>

@*<div id="mensaje_correo_gerencia" class="modal" style="width: 500px; height:300px; border: 1px solid #ccc; color: #666677; font-size:12px; padding:20px;  z-index: 5;">
        <div style="font-size:14px; border-bottom:1px solid #ff8000; padding-bottom:5px; ">
            <div class="celda"><h3><b id="titulo_cambio_estado">Enviar Mail a Gerencia</b></h3></div>
        </div>
        <div>
            <br />
            <label style="font-size:12px; color:coral"><b>Mensaje:&nbsp;&nbsp;</b></label>
        </div>
        <div class="celda" style="width: 100%; margin-top:10px; height:100px">
            <center>
                <textarea rows="5" id="txt_mensaje_correo" name="txt_mensaje_correo"></textarea>
            </center>
        </div>
        <div style="width:99%; text-align:center;  margin-top: 10px;">
            <center>
                <table>
                    <tr>
                        <td>
                            @if (IdUsuario == 10016)
                            {
                                <div class="boton" style="width:150px;" onclick="enviar_mail_gerencia(1)">Enviar Correo</div>
                            }
                            @if (idArea == 8)
                            {
                                <div class="boton" style="width:150px;" onclick="enviar_mail_gerencia(2)">Enviar Correo</div>
                            }

                        </td>
                        <td>
                            &nbsp;&nbsp;
                        </td>
                        <td>
                            <div class="boton" style="width:89px;" onClick="cerrar_ventana('#mensaje_correo_gerencia')">Cerrar</div>
                        </td>
                    </tr>
                </table>
            </center>
        </div>
    </div>*@


<script>

    function modal_dcto() {
        pop_up("#modal_descuentos", 850, 700);
        var prop = $(this).attr("id_prop");
        var arrendatario = $(this).attr("arrendatario");
        var propietario = $(this).attr("propietario");
        var direccion = $(this).attr("direccion");
        var depto = $(this).attr("depto");
        var id_contrato = $(this).attr("id_contrato");
        gastos(prop, 800, 300, arrendatario, propietario, direccion, depto, id_contrato);
        $("#fade").css("display", "none");
    }


    //$(".td_desc").click(function () {
    //    var enabled = $(this).attr("ena");
    //    pop_up("#modal_descuentos", 850, 700);
    //    var prop = $(this).attr("id_prop");
    //    var arrendatario = $(this).attr("arrendatario");
    //    var propietario = $(this).attr("propietario");
    //    var direccion = $(this).attr("direccion");
    //    var depto = $(this).attr("depto");
    //    var id_contrato = $(this).attr("id_contrato");

    //    if (enabled == "1")
    //    {
    //        // habilitamos
    //        $("#mes_gasto").css("pointer-events", "auto");
    //        $("#ano_gasto").css("pointer-events", "auto");
    //    } else if (enabled == "2") {
    //        // deshabilitamos
    //        $("#mes_gasto").css("pointer-events", "none");
    //        $("#ano_gasto").css("pointer-events", "none");
    //    }

    //    gastos(prop, 800, 300, arrendatario, propietario, direccion, depto, id_contrato);
    //    $("#fade").css("display", "none");
    //});

    function habilitar(value)
    {
        if (value == "1" || value == true)
        {
            // habilitamos
            $("#mes_gasto").css("pointer-events", "line");
            $("#ano_gasto").css("pointer-events", "line");
        } else if (value == "2" || value == false) {
            // deshabilitamos
            $("#mes_gasto").css("pointer-events", "none");
            $("#ano_gasto").css("pointer-events", "none");
        }
    };

    function gastos(id, pAncho, pAlto, arrendatario, propietario, direccion, depto, id_contrato) {

        //_TraeGastos(int propiedad, string mes)

        $("#fecha_gasto").val("");
        $("#observ_gasto").val("");
        $("#monto_inver").val("");
        $("#monto_arrend").val("");
        $("#monto_total").val("");
        $("#idContratoGasto").val("");

        $("#prop_gastos").html(propietario);
        $("#arr_gastos").html(arrendatario);
        $("#direccion_gastos").html(direccion);
        $("#depto_gastos").html(depto);
        $("#id_prop").val(id);
        $("#idContratoGasto").val(id_contrato);

        var ancho = pAncho;
        var alto = pAlto;
        var pVentana = "#gastos";
        var param = { "propiedad": id , "mes": "@mes", "ano": "@ano" };

        anchoActual = window.innerWidth;
        altoActual = window.innerHeight;

        margenTop = (((altoActual - alto - 40) / altoActual ) / 2 ) * 100
        porcTop = margenTop + '%';
        margenLeft = (((anchoActual - ancho - 50) / anchoActual ) / 2 ) * 100
        porcLeft = margenLeft + '%';

        if (altoActual < alto + 40) {
            $(pVentana).css("top","5px");
        } else {
            $(pVentana).css("top",porcTop);
        }

        if (anchoActual < ancho) {
            $(pVentana).css("left",0);
            $(pVentana).css("width","100%");
        } else {
            $(pVentana).css("left",porcLeft);
        }

        if (parseInt(window.innerHeight) > parseInt($("body").height()) ) {
            $("#fade").height(parseInt(window.innerHeight));
        } else {
            $("#fade").height(parseInt($("body").height()));
        }
        $("#fade").css("display","block");
        $(pVentana).css("display","block");

        $.ajax({
            data: param,
            url: "@Url.Action("_TraeGastos", "propiedades")",
            type: "get",
        beforeSend: function(){
            $("#gastos_interna").html("Un momento por favor.");
        },
        success: function (response) {
            $("#gastos_interna").html(response);
            }
        });
    }
    $(function () {
        $("#mes_gasto, #ano_gasto").change(function () {
            var id_prop = $("#id_prop").val();
            var mes = $("#mes_gasto").val();
            var ano = $("#ano_gasto").val()
            var param = { "propiedad": id_prop, "mes": mes, "ano": ano };
            $.ajax({
                data: param,
                url: "@Url.Action("_TraeGastos", "propiedades")",
                type: "get",
                beforeSend: function () {
                    $("#gastos_interna").html("Un momento por favor.");
                },
                success: function (response) {
                    $("#gastos_interna").html(response);
                }
            });
        });
    });
</script>

<div id="modal_descuentos" class="modal" style="width: 800px; height:380px; border: 1px solid #ccc; color: #666677; font-size:12px; display:none; padding:20px;  z-index: 5;">

    <div style="font-size:14px; border-bottom: 1px solid #ff8000; padding-bottom:10px;">
        <form name="gastos_form" id="gastos_form">
            <input type="hidden" id="idContratoGasto" />
            <div class="celda">Descuentos del mes: </div>
            <div class="celda" style="margin-left:5px;">
                <select id="mes_gasto" name="mes_gasto" style="color: #666666; width:99%">
                    <option value='00'>Todos</option>
                    <option value='01' @(mes == "01" ? "selected" : "")>Enero</option>
                    <option value='02' @(mes == "02" ? "selected" : "")>Febrero</option>
                    <option value='03' @(mes == "03" ? "selected" : "")>Marzo</option>
                    <option value='04' @(mes == "04" ? "selected" : "")>Abril</option>
                    <option value='05' @(mes == "05" ? "selected" : "")>Mayo</option>
                    <option value='06' @(mes == "06" ? "selected" : "")>Junio</option>
                    <option value='07' @(mes == "07" ? "selected" : "")>Julio</option>
                    <option value='08' @(mes == "08" ? "selected" : "")>Agosto</option>
                    <option value='09' @(mes == "09" ? "selected" : "")>Septiembre</option>
                    <option value='10' @(mes == "10" ? "selected" : "")>Octubre</option>
                    <option value='11' @(mes == "11" ? "selected" : "")>Noviembre</option>
                    <option value='12' @(mes == "12" ? "selected" : "")>Diciembre</option>
                </select>
                <input type="hidden" name="id_prop" id="id_prop" value="" />
            </div>
            <div class="celda" style="margin-left:5px;">
                <select id="ano_gasto" name="ano_gasto" style="color: #666666; width:99%">
                    @for (int i = 2016; i <= DateTime.Now.Year + 2; i++)
                    {
                        <option value='@i' @(int.Parse(ano) == i ? "selected" : "")>@i</option>
                    }
                </select>
            </div>
            <br /><br />
        </form>
    </div>
    <div style="font-size:12px; margin-top:10px;">
        <div class="celda" style="width:15%">Propietario:</div><div class="celda" style="width:35%"><strong id="prop_gastos">?</strong></div>
        <div class="celda" style="width:15%">Arrendatario:</div><div class="celda"><strong id="arr_gastos">?</strong></div>
    </div>
    <div style="font-size:12px;">
        <div class="celda" style="width:15%">Dirección:</div><div class="celda" style="width:35%"><strong id="direccion_gastos">?</strong></div>
        <div class="celda" style="width:15%">Departamento:</div><div class="celda" style="width:15%"><strong id="depto_gastos">#</strong></div>
    </div>
    <div id="gastos_interna" align="center" style="padding:0; margin-top: 10px; border: 1px solid #ccc; background: #fcfcfc; overflow: scroll; height: 170px;">
    </div>

    <div style="width:99%; text-align:center;  margin-top: 20px;">
        @*<div class="celda ancho" style="width:100px; margin-left:10px">
                <div class="boton" style="width:70px;">Grabar</div>
            </div>*@
        <div class="celda ancho" style="width:100px; margin-left:10px">
            <div class="boton" style="width:70px;" onClick="cerrar_ventana('#modal_descuentos')">Cerrar</div>
        </div>
    </div>
</div>

<div id="modal_antecedentes_propietario" class="modal" style="width: 1000px; height:700px; border: 1px solid #ccc; color: #666677; font-size:12px; padding:10px;  z-index: 5;">
    <div style="font-size:14px; border-bottom:1px solid #ff8000; padding-bottom:10px; ">
        <div class="celda"><h3><b>Antecedentes Propietario</b></h3></div>
    </div>
    <div style="padding-top:20px">
        <iframe id="frame_modal_antecedentes_propietario" src="" name="carga" width="100%" marginwidth="0" height="500" marginheight="0" align="top" frameborder="0" scrolling="no"></iframe>
    </div>
    <div style="padding-top:30px">
        <center><div class="boton" style="width:89px;" onClick="cerrar_ventana('#modal_antecedentes_propietario')">Cerrar</div></center>
    </div>
</div>

<div id="modal_cambio_liberar_pago" class="modal" style="width: 950px; height: 510px; border: 1px solid #ccc; color: #666677; font-size:12px; padding:20px;  z-index: 5;">

    <div>
        <div style="float: left;">
            <div class="celda" style="font-size: 18px;">
                Información de Pagos a Liberar
                <input type="date" id="fecha_estado_liberar_pago" name="fecha_estado_liberar_pago" value="@fec2" maxlength="12" style="width: 150px" class="fecha_estado_liberar_pago" hidden />
                <input type="text" id="new_estado_liberar_pago" value="" disabled hidden />
            </div>
        </div>
        <div style="float: right;"><button type="button" class="btn btn-sm btn-default" onClick="cerrar_ventana('#modal_cambio_liberar_pago')">X</button></div>
    </div>
    <div style="font-size:14px; border-bottom:1px solid #ff8000; padding-bottom:10px; clear: both;"></div>


    <div class="celda" style="width: 100%; margin-top:10px; height:450px; overflow: auto;" id="listado_liberar_pago">

    </div>
    @*<div style="width:99%; text-align:center;  margin-top: 20px;">
            <div class="celda ancho" style="width:100px;">
                <div class="boton" style="width:89px;" onClick="cerrar_ventana('#modal_cambio_liberar_pago')">CERRAR</div>
            </div>
        </div>*@
</div>


<div id="Modal_Carga_Facturas" class="modal" style="height: 800px; border: 1px solid #ccc; color: #666677; font-size:12px; display:none; z-index: 155;">
    <div style="font-size:14px; border-bottom:1px solid #ff8000; padding-bottom:10px; ">
        <div class="celda"><h3><b>Cargar Facturas Nubox</b></h3></div>
    </div>
    <div class="celda" style="width: 100%; margin-top:10px;overflow-y:scroll; overflow-x:hidden; height:100px">

    </div>
    <div style="width:99%; margin-top: 20px;">
        <div class="celda ancho" style="width:99%;">
            <div class="boton" style="width:70px; float: left;" onClick="cerrar_ventana('#Modal_Carga_Facturas')">Cerrar</div>
            <div class="boton" style="width:120px; float: left;" onClick="cerrar_ventana('#Modal_Carga_Facturas')">Subir Archivo</div>
        </div>
    </div>
</div>

<style>
    .btn_cerrar {
        background-color: #eeefff;
        border: solid 1px #666677;
    }
</style>

<script>


    $("#btn_cargar_facturas").click(function () {
        pop_up("#Modal_Carga_Facturas", 850, 900);
        $("#fade").css("display", "none");
    });

    function CargarFacturas() {
        
    }

    function descuentos_click(prop, propietario, direccion, depto, id_contrato,enabled) {
        pop_up("#modal_descuentos", 850, 700);
        if (enabled == "1")
        {
            // habilitamos
            $("#mes_gasto").css("pointer-events", "auto");
            $("#ano_gasto").css("pointer-events", "auto");
        } else if (enabled == "2") {
            // deshabilitamos
            $("#mes_gasto").css("pointer-events", "none");
            $("#ano_gasto").css("pointer-events", "none");
        }
        gastos(prop, 800, 300, " ", propietario, direccion, depto, id_contrato);
        $("#fade").css("display", "none");
    }

    function antecedentes_click(prop, contrato, zona) {
        pop_up("#modal_antecedentes_propietario", 850, 700);
        var url = "@Url.Action("formmodprop","propiedades")/" + prop + "?estado=110&id_contrato=" + contrato + "&desde_liquidaciones=1" + zona;
        $("#frame_modal_antecedentes_propietario").attr("src", url);
        $("#fade").css("display", "none");
    }


    function modal_liberar_pago() {
        var fecha = new Date(); //Fecha actual
        var mes = fecha.getMonth() + 1; //obteniendo mes
        var dia = fecha.getDate(); //obteniendo dia
        var ano = fecha.getFullYear(); //obteniendo año
        if (dia < 10) {
            dia = '0' + dia; //agrega cero si el menor de 10
        }
        if (mes < 10) {
            mes = '0' + mes //agrega cero si el menor de 10
        }
        document.getElementById('fecha_estado_liberar_pago').value = ano + "-" + mes + "-" + dia;
        document.getElementById('new_estado_liberar_pago').value = 35;
        pop_up("#modal_cambio_liberar_pago", 700, 500, scroll());
        $("#fade").css("display", "none");

        var mes_ini = $("#mes").val();
        var anio_ini = $("#ano").val();

        var mes_fin = $("#mes_fin").val();
        var anio_fin = $("#ano_fin").val();

        var estado_arriendo = $("#estado_arriendo").val();
        var estado_pago = $("#estado_pago").val();
        var sac_inversionista = $("#sac_inversionista").val();

        var fecha_ini = anio_ini + "-" + mes_ini + "-01";
        var fecha_fin = anio_fin + "-" + mes_fin + "-01";

        //_Aprobaciones_Comparativo(string mes, int id_estado_arriendo, int id_estado_propietario, string mes_hasta, int sac_inversionista)

        var param = { "mes": fecha_ini, "id_estado_arriendo": estado_arriendo, "id_estado_propietario": estado_pago, "mes_hasta": fecha_fin, "sac_inversionista": sac_inversionista };

        $.ajax({
            data: param,
            url: "@Url.Action("_Aprobaciones_Comparativo", "liquidacion")",
            type: "POST",
            beforeSend: function () {
                $("#listado_liberar_pago").html("<br/><br/><br/><h1><center>Un momento por favor.</center></h1>");
            },
            success: function (response) {
                $("#listado_liberar_pago").html(response);
            }
        });

    }




@*function enviar_mail_gerencia(id_tipo_correo) {
        if (@idArea==8) {
            var ids_pago = "0";
        } else {
            var ids_pago = new Array();

            $("input:checkbox[id='id']:checked").each(function () {
                ids_pago.push($(this).val());
            });
        }
        var mensaje = $("#txt_mensaje_correo").val();
        var tipo_correo = id_tipo_correo;

        var param = { "ids_pago": ids_pago, "mensaje": mensaje, "tipo_correo": tipo_correo };
        if (@idArea == 8) {
            $.ajax({
                data: param,
                url: "@Url.Action("_Envia_Alerta_Atencion_Gerencia", "liquidacion")",
                type: "POST",
                success: function (response) {
                    alert("Correo Enviado.");
                    cerrar_ventana("#mensaje_correo_gerencia");
                    $("#txt_mensaje_correo").val("");
                }
            });
        } else {
            if (ids_pago.length > 0) {
                $.ajax({
                    data: param,
                    url: "@Url.Action("_Envia_Alerta_Atencion_Gerencia", "liquidacion")",
                    type: "POST",
                    success: function (response) {
                        alert("Correo Enviado.");
                        cerrar_ventana("#mensaje_correo_gerencia");
                        $("#txt_mensaje_correo").val("");
                    }
                });
            } else {
                alert("Debe seleccionar al menos un pago.");
            }
        }
    }*@


    function enviar_mail_gerencia(id_tipo_correo) {
        var tipo_correo = id_tipo_correo;

        var mes_ini = $("#mes").val();
        var ano_ini = $("#ano").val();
        var mes_fin = $("#mes_fin").val();
        var ano_fin = $("#ano_fin").val();

        var fecha2 = ano_ini + "-" + mes_ini + "-01"
        var periodo = ano_fin + "-" + mes_fin + "-01"

        //alert(fecha2 +" | "+periodo);

         var param = { "tipo_correo": tipo_correo, "fecha": fecha2, "periodo": periodo };
        if (confirm("¿Desea enviar correo informativo?")) {
            $.ajax({
                data: param,
                url: "@Url.Action("_Envia_Alerta_Atencion_Gerencia_Nuevo", "liquidacion")",
                type: "POST",
                success: function (response) {
                    alert("Correo Enviado.");
                }
            });
        }
    }
    function enviar_mail_finanza(id_tipo_correo) {
        var tipo_correo = id_tipo_correo;

        var mes_ini = $("#mes").val();
        var ano_ini = $("#ano").val();
        var mes_fin = $("#mes_fin").val();
        var ano_fin = $("#ano_fin").val();

        var fecha2 = ano_ini + "-" + mes_ini + "-01"
        var periodo = ano_fin + "-" + mes_fin + "-01"

        var param = { "tipo_correo": tipo_correo, "fecha": fecha2, "periodo": periodo };
        if (confirm("¿Desea enviar correo informativo?")) {
            $.ajax({
                data: param,
                url: "@Url.Action("_Mail_Envia_Alerta_Atencion_Finanzas", "liquidacion")",
                type: "POST",
                success: function (response) {
                    alert("Correo Enviado.");
                }
            });
        }
    }
</script>
